import{r as requireHowler,R as Ray,P as Plane,V as Vector3,C as Controls,M as MOUSE,T as TOUCH,Q as Quaternion,S as Spherical,a as Vector2,b as MathUtils,L as Loader,F as FileLoader,c as SRGBColorSpace,d as LinearSRGBColorSpace,B as BufferGeometry,e as BufferAttribute,f as Color,g as ColorManagement,h as TrianglesDrawMode,i as TriangleFanDrawMode,j as TriangleStripDrawMode,k as LoaderUtils,l as SpotLight,m as PointLight,D as DirectionalLight,n as MeshBasicMaterial,o as MeshPhysicalMaterial,I as InstancedMesh,p as InstancedBufferAttribute,O as Object3D,q as TextureLoader,s as ImageBitmapLoader,t as InterleavedBuffer,u as LinearFilter,v as LinearMipmapLinearFilter,w as RepeatWrapping,N as NearestFilter,x as PointsMaterial,y as Material,z as LineBasicMaterial,A as MeshStandardMaterial,E as DoubleSide,G as PropertyBinding,H as SkinnedMesh,J as Mesh,K as LineSegments,U as Line,W as LineLoop,X as Points,Y as Group,Z as PerspectiveCamera,_ as OrthographicCamera,$ as Skeleton,a0 as AnimationClip,a1 as Bone,a2 as InterpolateLinear,a3 as Matrix4,a4 as NearestMipmapNearestFilter,a5 as LinearMipmapNearestFilter,a6 as NearestMipmapLinearFilter,a7 as ClampToEdgeWrapping,a8 as MirroredRepeatWrapping,a9 as InterpolateDiscrete,aa as FrontSide,ab as InterleavedBufferAttribute,ac as Texture,ad as VectorKeyframeTrack,ae as NumberKeyframeTrack,af as QuaternionKeyframeTrack,ag as Box3,ah as Sphere,ai as Interpolant,aj as Scene,ak as WebGLRenderer,al as gsapWithCSS,am as CubeTextureLoader,an as PlaneGeometry,ao as ShaderMaterial,ap as Uniform,aq as VideoTexture,ar as Euler,as as Raycaster,at as LoadingManager,au as Clock}from"./vendor-wjmIrX7P.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))s(n);new MutationObserver(n=>{for(const o of n)if(o.type==="childList")for(const i of o.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&s(i)}).observe(document,{childList:!0,subtree:!0});function t(n){const o={};return n.integrity&&(o.integrity=n.integrity),n.referrerPolicy&&(o.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?o.credentials="include":n.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function s(n){if(n.ep)return;n.ep=!0;const o=t(n);fetch(n.href,o)}})();var howlerExports=requireHowler();const _changeEvent={type:"change"},_startEvent={type:"start"},_endEvent={type:"end"},_ray=new Ray,_plane=new Plane,_TILT_LIMIT=Math.cos(70*MathUtils.DEG2RAD),minPan=new Vector3(-3,-1,-4),maxPan=new Vector3(2,8,8),_v=new Vector3,_twoPI=2*Math.PI,_STATE={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6},_EPS=1e-6;class OrbitControls extends Controls{constructor(e,t=null){super(e,t),this.state=_STATE.NONE,this.enabled=!0,this.target=new Vector3,this.cursor=new Vector3,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minTargetRadius=0,this.maxTargetRadius=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.keyRotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.zoomToCursor=!1,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:MOUSE.ROTATE,MIDDLE:MOUSE.DOLLY,RIGHT:MOUSE.PAN},this.touches={ONE:TOUCH.ROTATE,TWO:TOUCH.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this._lastPosition=new Vector3,this._lastQuaternion=new Quaternion,this._lastTargetPosition=new Vector3,this._quat=new Quaternion().setFromUnitVectors(e.up,new Vector3(0,1,0)),this._quatInverse=this._quat.clone().invert(),this._spherical=new Spherical,this._sphericalDelta=new Spherical,this._scale=1,this._panOffset=new Vector3,this._rotateStart=new Vector2,this._rotateEnd=new Vector2,this._rotateDelta=new Vector2,this._panStart=new Vector2,this._panEnd=new Vector2,this._panDelta=new Vector2,this._dollyStart=new Vector2,this._dollyEnd=new Vector2,this._dollyDelta=new Vector2,this._dollyDirection=new Vector3,this._mouse=new Vector2,this._performCursorZoom=!1,this._pointers=[],this._pointerPositions={},this._controlActive=!1,this._onPointerMove=onPointerMove.bind(this),this._onPointerDown=onPointerDown.bind(this),this._onPointerUp=onPointerUp.bind(this),this._onContextMenu=onContextMenu.bind(this),this._onMouseWheel=onMouseWheel.bind(this),this._onKeyDown=onKeyDown.bind(this),this._onTouchStart=onTouchStart.bind(this),this._onTouchMove=onTouchMove.bind(this),this._onMouseDown=onMouseDown.bind(this),this._onMouseMove=onMouseMove.bind(this),this._interceptControlDown=interceptControlDown.bind(this),this._interceptControlUp=interceptControlUp.bind(this),this.domElement!==null&&this.connect(),this.update()}connect(){this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointercancel",this._onPointerUp),this.domElement.addEventListener("contextmenu",this._onContextMenu),this.domElement.addEventListener("wheel",this._onMouseWheel,{passive:!1}),this.domElement.getRootNode().addEventListener("keydown",this._interceptControlDown,{passive:!0,capture:!0}),this.domElement.style.touchAction="none"}disconnect(){this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.domElement.removeEventListener("pointercancel",this._onPointerUp),this.domElement.removeEventListener("wheel",this._onMouseWheel),this.domElement.removeEventListener("contextmenu",this._onContextMenu),this.stopListenToKeyEvents(),this.domElement.getRootNode().removeEventListener("keydown",this._interceptControlDown,{capture:!0}),this.domElement.style.touchAction="auto"}dispose(){this.disconnect()}getPolarAngle(){return this._spherical.phi}getAzimuthalAngle(){return this._spherical.theta}getDistance(){return this.object.position.distanceTo(this.target)}listenToKeyEvents(e){e.addEventListener("keydown",this._onKeyDown),this._domElementKeyEvents=e}stopListenToKeyEvents(){this._domElementKeyEvents!==null&&(this._domElementKeyEvents.removeEventListener("keydown",this._onKeyDown),this._domElementKeyEvents=null)}saveState(){this.target0.copy(this.target),this.position0.copy(this.object.position),this.zoom0=this.object.zoom}reset(){this.target.copy(this.target0),this.object.position.copy(this.position0),this.object.zoom=this.zoom0,this.object.updateProjectionMatrix(),this.dispatchEvent(_changeEvent),this.update(),this.state=_STATE.NONE}update(e=null){const t=this.object.position;_v.copy(t).sub(this.target),_v.applyQuaternion(this._quat),this._spherical.setFromVector3(_v),this.autoRotate&&this.state===_STATE.NONE&&this._rotateLeft(this._getAutoRotationAngle(e)),this.enableDamping?(this._spherical.theta+=this._sphericalDelta.theta*this.dampingFactor,this._spherical.phi+=this._sphericalDelta.phi*this.dampingFactor):(this._spherical.theta+=this._sphericalDelta.theta,this._spherical.phi+=this._sphericalDelta.phi);let s=this.minAzimuthAngle,n=this.maxAzimuthAngle;isFinite(s)&&isFinite(n)&&(s<-Math.PI?s+=_twoPI:s>Math.PI&&(s-=_twoPI),n<-Math.PI?n+=_twoPI:n>Math.PI&&(n-=_twoPI),s<=n?this._spherical.theta=Math.max(s,Math.min(n,this._spherical.theta)):this._spherical.theta=this._spherical.theta>(s+n)/2?Math.max(s,this._spherical.theta):Math.min(n,this._spherical.theta)),this._spherical.phi=Math.max(this.minPolarAngle,Math.min(this.maxPolarAngle,this._spherical.phi)),this._spherical.makeSafe(),this.enableDamping===!0?this.target.addScaledVector(this._panOffset,this.dampingFactor):this.target.add(this._panOffset),this.target.clamp(minPan,maxPan),this.target.sub(this.cursor),this.target.clampLength(this.minTargetRadius,this.maxTargetRadius),this.target.add(this.cursor);let o=!1;if(this.zoomToCursor&&this._performCursorZoom||this.object.isOrthographicCamera)this._spherical.radius=this._clampDistance(this._spherical.radius);else{const i=this._spherical.radius;this._spherical.radius=this._clampDistance(this._spherical.radius*this._scale),o=i!=this._spherical.radius}if(_v.setFromSpherical(this._spherical),_v.applyQuaternion(this._quatInverse),t.copy(this.target).add(_v),this.object.lookAt(this.target),this.enableDamping===!0?(this._sphericalDelta.theta*=1-this.dampingFactor,this._sphericalDelta.phi*=1-this.dampingFactor,this._panOffset.multiplyScalar(1-this.dampingFactor)):(this._sphericalDelta.set(0,0,0),this._panOffset.set(0,0,0)),this.zoomToCursor&&this._performCursorZoom){let i=null;if(this.object.isPerspectiveCamera){const l=_v.length();i=this._clampDistance(l*this._scale);const r=l-i;this.object.position.addScaledVector(this._dollyDirection,r),this.object.updateMatrixWorld(),o=!!r}else if(this.object.isOrthographicCamera){const l=new Vector3(this._mouse.x,this._mouse.y,0);l.unproject(this.object);const r=this.object.zoom;this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom/this._scale)),this.object.updateProjectionMatrix(),o=r!==this.object.zoom;const c=new Vector3(this._mouse.x,this._mouse.y,0);c.unproject(this.object),this.object.position.sub(c).add(l),this.object.updateMatrixWorld(),i=_v.length()}else console.warn("WARNING: OrbitControls.js encountered an unknown camera type - zoom to cursor disabled."),this.zoomToCursor=!1;i!==null&&(this.screenSpacePanning?this.target.set(0,0,-1).transformDirection(this.object.matrix).multiplyScalar(i).add(this.object.position):(_ray.origin.copy(this.object.position),_ray.direction.set(0,0,-1).transformDirection(this.object.matrix),Math.abs(this.object.up.dot(_ray.direction))<_TILT_LIMIT?this.object.lookAt(this.target):(_plane.setFromNormalAndCoplanarPoint(this.object.up,this.target),_ray.intersectPlane(_plane,this.target))))}else if(this.object.isOrthographicCamera){const i=this.object.zoom;this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom/this._scale)),i!==this.object.zoom&&(this.object.updateProjectionMatrix(),o=!0)}return this._scale=1,this._performCursorZoom=!1,o||this._lastPosition.distanceToSquared(this.object.position)>_EPS||8*(1-this._lastQuaternion.dot(this.object.quaternion))>_EPS||this._lastTargetPosition.distanceToSquared(this.target)>_EPS?(this.dispatchEvent(_changeEvent),this._lastPosition.copy(this.object.position),this._lastQuaternion.copy(this.object.quaternion),this._lastTargetPosition.copy(this.target),!0):!1}_getAutoRotationAngle(e){return e!==null?_twoPI/60*this.autoRotateSpeed*e:_twoPI/60/60*this.autoRotateSpeed}_getZoomScale(e){const t=Math.abs(e*.01);return Math.pow(.95,this.zoomSpeed*t)}_rotateLeft(e){this._sphericalDelta.theta-=e}_rotateUp(e){this._sphericalDelta.phi-=e}_panLeft(e,t){_v.setFromMatrixColumn(t,0),_v.multiplyScalar(-e),this._panOffset.add(_v)}_panUp(e,t){this.screenSpacePanning===!0?_v.setFromMatrixColumn(t,1):(_v.setFromMatrixColumn(t,0),_v.crossVectors(this.object.up,_v)),_v.multiplyScalar(e),this._panOffset.add(_v)}_pan(e,t){const s=this.domElement;if(this.object.isPerspectiveCamera){const n=this.object.position;_v.copy(n).sub(this.target);let o=_v.length();o*=Math.tan(this.object.fov/2*Math.PI/180),this._panLeft(2*e*o/s.clientHeight,this.object.matrix),this._panUp(2*t*o/s.clientHeight,this.object.matrix)}else this.object.isOrthographicCamera?(this._panLeft(e*(this.object.right-this.object.left)/this.object.zoom/s.clientWidth,this.object.matrix),this._panUp(t*(this.object.top-this.object.bottom)/this.object.zoom/s.clientHeight,this.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),this.enablePan=!1)}_dollyOut(e){this.object.isPerspectiveCamera||this.object.isOrthographicCamera?this._scale/=e:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),this.enableZoom=!1)}_dollyIn(e){this.object.isPerspectiveCamera||this.object.isOrthographicCamera?this._scale*=e:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),this.enableZoom=!1)}_updateZoomParameters(e,t){if(!this.zoomToCursor)return;this._performCursorZoom=!0;const s=this.domElement.getBoundingClientRect(),n=e-s.left,o=t-s.top,i=s.width,l=s.height;this._mouse.x=n/i*2-1,this._mouse.y=-(o/l)*2+1,this._dollyDirection.set(this._mouse.x,this._mouse.y,1).unproject(this.object).sub(this.object.position).normalize()}_clampDistance(e){return Math.max(this.minDistance,Math.min(this.maxDistance,e))}_handleMouseDownRotate(e){this._rotateStart.set(e.clientX,e.clientY)}_handleMouseDownDolly(e){this._updateZoomParameters(e.clientX,e.clientX),this._dollyStart.set(e.clientX,e.clientY)}_handleMouseDownPan(e){this._panStart.set(e.clientX,e.clientY)}_handleMouseMoveRotate(e){this._rotateEnd.set(e.clientX,e.clientY),this._rotateDelta.subVectors(this._rotateEnd,this._rotateStart).multiplyScalar(this.rotateSpeed);const t=this.domElement;this._rotateLeft(_twoPI*this._rotateDelta.x/t.clientHeight),this._rotateUp(_twoPI*this._rotateDelta.y/t.clientHeight),this._rotateStart.copy(this._rotateEnd),this.update()}_handleMouseMoveDolly(e){this._dollyEnd.set(e.clientX,e.clientY),this._dollyDelta.subVectors(this._dollyEnd,this._dollyStart),this._dollyDelta.y>0?this._dollyOut(this._getZoomScale(this._dollyDelta.y)):this._dollyDelta.y<0&&this._dollyIn(this._getZoomScale(this._dollyDelta.y)),this._dollyStart.copy(this._dollyEnd),this.update()}_handleMouseMovePan(e){this._panEnd.set(e.clientX,e.clientY),this._panDelta.subVectors(this._panEnd,this._panStart).multiplyScalar(this.panSpeed),this._pan(this._panDelta.x,this._panDelta.y),this._panStart.copy(this._panEnd),this.update()}_handleMouseWheel(e){this._updateZoomParameters(e.clientX,e.clientY),e.deltaY<0?this._dollyIn(this._getZoomScale(e.deltaY)):e.deltaY>0&&this._dollyOut(this._getZoomScale(e.deltaY)),this.update()}_handleKeyDown(e){let t=!1;switch(e.code){case this.keys.UP:e.ctrlKey||e.metaKey||e.shiftKey?this.enableRotate&&this._rotateUp(_twoPI*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(0,this.keyPanSpeed),t=!0;break;case this.keys.BOTTOM:e.ctrlKey||e.metaKey||e.shiftKey?this.enableRotate&&this._rotateUp(-_twoPI*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(0,-this.keyPanSpeed),t=!0;break;case this.keys.LEFT:e.ctrlKey||e.metaKey||e.shiftKey?this.enableRotate&&this._rotateLeft(_twoPI*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(this.keyPanSpeed,0),t=!0;break;case this.keys.RIGHT:e.ctrlKey||e.metaKey||e.shiftKey?this.enableRotate&&this._rotateLeft(-_twoPI*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(-this.keyPanSpeed,0),t=!0;break}t&&(e.preventDefault(),this.update())}_handleTouchStartRotate(e){if(this._pointers.length===1)this._rotateStart.set(e.pageX,e.pageY);else{const t=this._getSecondPointerPosition(e),s=.5*(e.pageX+t.x),n=.5*(e.pageY+t.y);this._rotateStart.set(s,n)}}_handleTouchStartPan(e){if(this._pointers.length===1)this._panStart.set(e.pageX,e.pageY);else{const t=this._getSecondPointerPosition(e),s=.5*(e.pageX+t.x),n=.5*(e.pageY+t.y);this._panStart.set(s,n)}}_handleTouchStartDolly(e){const t=this._getSecondPointerPosition(e),s=e.pageX-t.x,n=e.pageY-t.y,o=Math.sqrt(s*s+n*n);this._dollyStart.set(0,o)}_handleTouchStartDollyPan(e){this.enableZoom&&this._handleTouchStartDolly(e),this.enablePan&&this._handleTouchStartPan(e)}_handleTouchStartDollyRotate(e){this.enableZoom&&this._handleTouchStartDolly(e),this.enableRotate&&this._handleTouchStartRotate(e)}_handleTouchMoveRotate(e){if(this._pointers.length==1)this._rotateEnd.set(e.pageX,e.pageY);else{const s=this._getSecondPointerPosition(e),n=.5*(e.pageX+s.x),o=.5*(e.pageY+s.y);this._rotateEnd.set(n,o)}this._rotateDelta.subVectors(this._rotateEnd,this._rotateStart).multiplyScalar(this.rotateSpeed);const t=this.domElement;this._rotateLeft(_twoPI*this._rotateDelta.x/t.clientHeight),this._rotateUp(_twoPI*this._rotateDelta.y/t.clientHeight),this._rotateStart.copy(this._rotateEnd)}_handleTouchMovePan(e){if(this._pointers.length===1)this._panEnd.set(e.pageX,e.pageY);else{const t=this._getSecondPointerPosition(e),s=.5*(e.pageX+t.x),n=.5*(e.pageY+t.y);this._panEnd.set(s,n)}this._panDelta.subVectors(this._panEnd,this._panStart).multiplyScalar(this.panSpeed),this._pan(this._panDelta.x,this._panDelta.y),this._panStart.copy(this._panEnd)}_handleTouchMoveDolly(e){const t=this._getSecondPointerPosition(e),s=e.pageX-t.x,n=e.pageY-t.y,o=Math.sqrt(s*s+n*n);this._dollyEnd.set(0,o),this._dollyDelta.set(0,Math.pow(this._dollyEnd.y/this._dollyStart.y,this.zoomSpeed)),this._dollyOut(this._dollyDelta.y),this._dollyStart.copy(this._dollyEnd);const i=(e.pageX+t.x)*.5,l=(e.pageY+t.y)*.5;this._updateZoomParameters(i,l)}_handleTouchMoveDollyPan(e){this.enableZoom&&this._handleTouchMoveDolly(e),this.enablePan&&this._handleTouchMovePan(e)}_handleTouchMoveDollyRotate(e){this.enableZoom&&this._handleTouchMoveDolly(e),this.enableRotate&&this._handleTouchMoveRotate(e)}_addPointer(e){this._pointers.push(e.pointerId)}_removePointer(e){delete this._pointerPositions[e.pointerId];for(let t=0;t<this._pointers.length;t++)if(this._pointers[t]==e.pointerId){this._pointers.splice(t,1);return}}_isTrackingPointer(e){for(let t=0;t<this._pointers.length;t++)if(this._pointers[t]==e.pointerId)return!0;return!1}_trackPointer(e){let t=this._pointerPositions[e.pointerId];t===void 0&&(t=new Vector2,this._pointerPositions[e.pointerId]=t),t.set(e.pageX,e.pageY)}_getSecondPointerPosition(e){const t=e.pointerId===this._pointers[0]?this._pointers[1]:this._pointers[0];return this._pointerPositions[t]}_customWheelEvent(e){const t=e.deltaMode,s={clientX:e.clientX,clientY:e.clientY,deltaY:e.deltaY};switch(t){case 1:s.deltaY*=16;break;case 2:s.deltaY*=100;break}return e.ctrlKey&&!this._controlActive&&(s.deltaY*=10),s}}function onPointerDown(a){this.enabled!==!1&&(this._pointers.length===0&&(this.domElement.setPointerCapture(a.pointerId),this.domElement.addEventListener("pointermove",this._onPointerMove),this.domElement.addEventListener("pointerup",this._onPointerUp)),!this._isTrackingPointer(a)&&(this._addPointer(a),a.pointerType==="touch"?this._onTouchStart(a):this._onMouseDown(a)))}function onPointerMove(a){this.enabled!==!1&&(a.pointerType==="touch"?this._onTouchMove(a):this._onMouseMove(a))}function onPointerUp(a){switch(this._removePointer(a),this._pointers.length){case 0:this.domElement.releasePointerCapture(a.pointerId),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.dispatchEvent(_endEvent),this.state=_STATE.NONE;break;case 1:const e=this._pointers[0],t=this._pointerPositions[e];this._onTouchStart({pointerId:e,pageX:t.x,pageY:t.y});break}}function onMouseDown(a){let e;switch(a.button){case 0:e=this.mouseButtons.LEFT;break;case 1:e=this.mouseButtons.MIDDLE;break;case 2:e=this.mouseButtons.RIGHT;break;default:e=-1}switch(e){case MOUSE.DOLLY:if(this.enableZoom===!1)return;this._handleMouseDownDolly(a),this.state=_STATE.DOLLY;break;case MOUSE.ROTATE:if(a.ctrlKey||a.metaKey||a.shiftKey){if(this.enablePan===!1)return;this._handleMouseDownPan(a),this.state=_STATE.PAN}else{if(this.enableRotate===!1)return;this._handleMouseDownRotate(a),this.state=_STATE.ROTATE}break;case MOUSE.PAN:if(a.ctrlKey||a.metaKey||a.shiftKey){if(this.enableRotate===!1)return;this._handleMouseDownRotate(a),this.state=_STATE.ROTATE}else{if(this.enablePan===!1)return;this._handleMouseDownPan(a),this.state=_STATE.PAN}break;default:this.state=_STATE.NONE}this.state!==_STATE.NONE&&this.dispatchEvent(_startEvent)}function onMouseMove(a){switch(this.state){case _STATE.ROTATE:if(this.enableRotate===!1)return;this._handleMouseMoveRotate(a);break;case _STATE.DOLLY:if(this.enableZoom===!1)return;this._handleMouseMoveDolly(a);break;case _STATE.PAN:if(this.enablePan===!1)return;this._handleMouseMovePan(a);break}}function onMouseWheel(a){this.enabled===!1||this.enableZoom===!1||this.state!==_STATE.NONE||(a.preventDefault(),this.dispatchEvent(_startEvent),this._handleMouseWheel(this._customWheelEvent(a)),this.dispatchEvent(_endEvent))}function onKeyDown(a){this.enabled!==!1&&this._handleKeyDown(a)}function onTouchStart(a){switch(this._trackPointer(a),this._pointers.length){case 1:switch(this.touches.ONE){case TOUCH.ROTATE:if(this.enableRotate===!1)return;this._handleTouchStartRotate(a),this.state=_STATE.TOUCH_ROTATE;break;case TOUCH.PAN:if(this.enablePan===!1)return;this._handleTouchStartPan(a),this.state=_STATE.TOUCH_PAN;break;default:this.state=_STATE.NONE}break;case 2:switch(this.touches.TWO){case TOUCH.DOLLY_PAN:if(this.enableZoom===!1&&this.enablePan===!1)return;this._handleTouchStartDollyPan(a),this.state=_STATE.TOUCH_DOLLY_PAN;break;case TOUCH.DOLLY_ROTATE:if(this.enableZoom===!1&&this.enableRotate===!1)return;this._handleTouchStartDollyRotate(a),this.state=_STATE.TOUCH_DOLLY_ROTATE;break;default:this.state=_STATE.NONE}break;default:this.state=_STATE.NONE}this.state!==_STATE.NONE&&this.dispatchEvent(_startEvent)}function onTouchMove(a){switch(this._trackPointer(a),this.state){case _STATE.TOUCH_ROTATE:if(this.enableRotate===!1)return;this._handleTouchMoveRotate(a),this.update();break;case _STATE.TOUCH_PAN:if(this.enablePan===!1)return;this._handleTouchMovePan(a),this.update();break;case _STATE.TOUCH_DOLLY_PAN:if(this.enableZoom===!1&&this.enablePan===!1)return;this._handleTouchMoveDollyPan(a),this.update();break;case _STATE.TOUCH_DOLLY_ROTATE:if(this.enableZoom===!1&&this.enableRotate===!1)return;this._handleTouchMoveDollyRotate(a),this.update();break;default:this.state=_STATE.NONE}}function onContextMenu(a){this.enabled!==!1&&a.preventDefault()}function interceptControlDown(a){a.key==="Control"&&(this._controlActive=!0,this.domElement.getRootNode().addEventListener("keyup",this._interceptControlUp,{passive:!0,capture:!0}))}function interceptControlUp(a){a.key==="Control"&&(this._controlActive=!1,this.domElement.getRootNode().removeEventListener("keyup",this._interceptControlUp,{passive:!0,capture:!0}))}const _taskCache=new WeakMap;class DRACOLoader extends Loader{constructor(e){super(e),this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},this.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"}}setDecoderPath(e){return this.decoderPath=e,this}setDecoderConfig(e){return this.decoderConfig=e,this}setWorkerLimit(e){return this.workerLimit=e,this}load(e,t,s,n){const o=new FileLoader(this.manager);o.setPath(this.path),o.setResponseType("arraybuffer"),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(e,i=>{this.parse(i,t,n)},s,n)}parse(e,t,s=()=>{}){this.decodeDracoFile(e,t,null,null,SRGBColorSpace,s).catch(s)}decodeDracoFile(e,t,s,n,o=LinearSRGBColorSpace,i=()=>{}){const l={attributeIDs:s||this.defaultAttributeIDs,attributeTypes:n||this.defaultAttributeTypes,useUniqueIDs:!!s,vertexColorSpace:o};return this.decodeGeometry(e,l).then(t).catch(i)}decodeGeometry(e,t){const s=JSON.stringify(t);if(_taskCache.has(e)){const r=_taskCache.get(e);if(r.key===s)return r.promise;if(e.byteLength===0)throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}let n;const o=this.workerNextTaskID++,i=e.byteLength,l=this._getWorker(o,i).then(r=>(n=r,new Promise((c,h)=>{n._callbacks[o]={resolve:c,reject:h},n.postMessage({type:"decode",id:o,taskConfig:t,buffer:e},[e])}))).then(r=>this._createGeometry(r.geometry));return l.catch(()=>!0).then(()=>{n&&o&&this._releaseTask(n,o)}),_taskCache.set(e,{key:s,promise:l}),l}_createGeometry(e){const t=new BufferGeometry;e.index&&t.setIndex(new BufferAttribute(e.index.array,1));for(let s=0;s<e.attributes.length;s++){const n=e.attributes[s],o=n.name,i=n.array,l=n.itemSize,r=new BufferAttribute(i,l);o==="color"&&(this._assignVertexColorSpace(r,n.vertexColorSpace),r.normalized=!(i instanceof Float32Array)),t.setAttribute(o,r)}return t}_assignVertexColorSpace(e,t){if(t!==SRGBColorSpace)return;const s=new Color;for(let n=0,o=e.count;n<o;n++)s.fromBufferAttribute(e,n),ColorManagement.toWorkingColorSpace(s,SRGBColorSpace),e.setXYZ(n,s.r,s.g,s.b)}_loadLibrary(e,t){const s=new FileLoader(this.manager);return s.setPath(this.decoderPath),s.setResponseType(t),s.setWithCredentials(this.withCredentials),new Promise((n,o)=>{s.load(e,n,void 0,o)})}preload(){return this._initDecoder(),this}_initDecoder(){if(this.decoderPending)return this.decoderPending;const e=typeof WebAssembly!="object"||this.decoderConfig.type==="js",t=[];return e?t.push(this._loadLibrary("draco_decoder.js","text")):(t.push(this._loadLibrary("draco_wasm_wrapper.js","text")),t.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(t).then(s=>{const n=s[0];e||(this.decoderConfig.wasmBinary=s[1]);const o=DRACOWorker.toString(),i=["/* draco decoder */",n,"","/* worker */",o.substring(o.indexOf("{")+1,o.lastIndexOf("}"))].join(`
`);this.workerSourceURL=URL.createObjectURL(new Blob([i]))}),this.decoderPending}_getWorker(e,t){return this._initDecoder().then(()=>{if(this.workerPool.length<this.workerLimit){const n=new Worker(this.workerSourceURL);n._callbacks={},n._taskCosts={},n._taskLoad=0,n.postMessage({type:"init",decoderConfig:this.decoderConfig}),n.onmessage=function(o){const i=o.data;switch(i.type){case"decode":n._callbacks[i.id].resolve(i);break;case"error":n._callbacks[i.id].reject(i);break;default:console.error('THREE.DRACOLoader: Unexpected message, "'+i.type+'"')}},this.workerPool.push(n)}else this.workerPool.sort(function(n,o){return n._taskLoad>o._taskLoad?-1:1});const s=this.workerPool[this.workerPool.length-1];return s._taskCosts[e]=t,s._taskLoad+=t,s})}_releaseTask(e,t){e._taskLoad-=e._taskCosts[t],delete e._callbacks[t],delete e._taskCosts[t]}debug(){console.log("Task load: ",this.workerPool.map(e=>e._taskLoad))}dispose(){for(let e=0;e<this.workerPool.length;++e)this.workerPool[e].terminate();return this.workerPool.length=0,this.workerSourceURL!==""&&URL.revokeObjectURL(this.workerSourceURL),this}}function DRACOWorker(){let a,e;onmessage=function(i){const l=i.data;switch(l.type){case"init":a=l.decoderConfig,e=new Promise(function(h){a.onModuleLoaded=function(u){h({draco:u})},DracoDecoderModule(a)});break;case"decode":const r=l.buffer,c=l.taskConfig;e.then(h=>{const u=h.draco,d=new u.Decoder;try{const p=t(u,d,new Int8Array(r),c),f=p.attributes.map(_=>_.array.buffer);p.index&&f.push(p.index.array.buffer),self.postMessage({type:"decode",id:l.id,geometry:p},f)}catch(p){console.error(p),self.postMessage({type:"error",id:l.id,error:p.message})}finally{u.destroy(d)}});break}};function t(i,l,r,c){const h=c.attributeIDs,u=c.attributeTypes;let d,p;const f=l.GetEncodedGeometryType(r);if(f===i.TRIANGULAR_MESH)d=new i.Mesh,p=l.DecodeArrayToMesh(r,r.byteLength,d);else if(f===i.POINT_CLOUD)d=new i.PointCloud,p=l.DecodeArrayToPointCloud(r,r.byteLength,d);else throw new Error("THREE.DRACOLoader: Unexpected geometry type.");if(!p.ok()||d.ptr===0)throw new Error("THREE.DRACOLoader: Decoding failed: "+p.error_msg());const _={index:null,attributes:[]};for(const m in h){const g=self[u[m]];let T,S;if(c.useUniqueIDs)S=h[m],T=l.GetAttributeByUniqueId(d,S);else{if(S=l.GetAttributeId(d,i[h[m]]),S===-1)continue;T=l.GetAttribute(d,S)}const y=n(i,l,d,m,g,T);m==="color"&&(y.vertexColorSpace=c.vertexColorSpace),_.attributes.push(y)}return f===i.TRIANGULAR_MESH&&(_.index=s(i,l,d)),i.destroy(d),_}function s(i,l,r){const h=r.num_faces()*3,u=h*4,d=i._malloc(u);l.GetTrianglesUInt32Array(r,u,d);const p=new Uint32Array(i.HEAPF32.buffer,d,h).slice();return i._free(d),{array:p,itemSize:1}}function n(i,l,r,c,h,u){const d=u.num_components(),f=r.num_points()*d,_=f*h.BYTES_PER_ELEMENT,m=o(i,h),g=i._malloc(_);l.GetAttributeDataArrayForAllPoints(r,u,m,_,g);const T=new h(i.HEAPF32.buffer,g,f).slice();return i._free(g),{name:c,array:T,itemSize:d}}function o(i,l){switch(l){case Float32Array:return i.DT_FLOAT32;case Int8Array:return i.DT_INT8;case Int16Array:return i.DT_INT16;case Int32Array:return i.DT_INT32;case Uint8Array:return i.DT_UINT8;case Uint16Array:return i.DT_UINT16;case Uint32Array:return i.DT_UINT32}}}function toTrianglesDrawMode(a,e){if(e===TrianglesDrawMode)return console.warn("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles."),a;if(e===TriangleFanDrawMode||e===TriangleStripDrawMode){let t=a.getIndex();if(t===null){const i=[],l=a.getAttribute("position");if(l!==void 0){for(let r=0;r<l.count;r++)i.push(r);a.setIndex(i),t=a.getIndex()}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),a}const s=t.count-2,n=[];if(e===TriangleFanDrawMode)for(let i=1;i<=s;i++)n.push(t.getX(0)),n.push(t.getX(i)),n.push(t.getX(i+1));else for(let i=0;i<s;i++)i%2===0?(n.push(t.getX(i)),n.push(t.getX(i+1)),n.push(t.getX(i+2))):(n.push(t.getX(i+2)),n.push(t.getX(i+1)),n.push(t.getX(i)));n.length/3!==s&&console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const o=a.clone();return o.setIndex(n),o.clearGroups(),o}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:",e),a}class GLTFLoader extends Loader{constructor(e){super(e),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(t){return new GLTFMaterialsClearcoatExtension(t)}),this.register(function(t){return new GLTFMaterialsDispersionExtension(t)}),this.register(function(t){return new GLTFTextureBasisUExtension(t)}),this.register(function(t){return new GLTFTextureWebPExtension(t)}),this.register(function(t){return new GLTFTextureAVIFExtension(t)}),this.register(function(t){return new GLTFMaterialsSheenExtension(t)}),this.register(function(t){return new GLTFMaterialsTransmissionExtension(t)}),this.register(function(t){return new GLTFMaterialsVolumeExtension(t)}),this.register(function(t){return new GLTFMaterialsIorExtension(t)}),this.register(function(t){return new GLTFMaterialsEmissiveStrengthExtension(t)}),this.register(function(t){return new GLTFMaterialsSpecularExtension(t)}),this.register(function(t){return new GLTFMaterialsIridescenceExtension(t)}),this.register(function(t){return new GLTFMaterialsAnisotropyExtension(t)}),this.register(function(t){return new GLTFMaterialsBumpExtension(t)}),this.register(function(t){return new GLTFLightsExtension(t)}),this.register(function(t){return new GLTFMeshoptCompression(t)}),this.register(function(t){return new GLTFMeshGpuInstancing(t)})}load(e,t,s,n){const o=this;let i;if(this.resourcePath!=="")i=this.resourcePath;else if(this.path!==""){const c=LoaderUtils.extractUrlBase(e);i=LoaderUtils.resolveURL(c,this.path)}else i=LoaderUtils.extractUrlBase(e);this.manager.itemStart(e);const l=function(c){n?n(c):console.error(c),o.manager.itemError(e),o.manager.itemEnd(e)},r=new FileLoader(this.manager);r.setPath(this.path),r.setResponseType("arraybuffer"),r.setRequestHeader(this.requestHeader),r.setWithCredentials(this.withCredentials),r.load(e,function(c){try{o.parse(c,i,function(h){t(h),o.manager.itemEnd(e)},l)}catch(h){l(h)}},s,l)}setDRACOLoader(e){return this.dracoLoader=e,this}setKTX2Loader(e){return this.ktx2Loader=e,this}setMeshoptDecoder(e){return this.meshoptDecoder=e,this}register(e){return this.pluginCallbacks.indexOf(e)===-1&&this.pluginCallbacks.push(e),this}unregister(e){return this.pluginCallbacks.indexOf(e)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,t,s,n){let o;const i={},l={},r=new TextDecoder;if(typeof e=="string")o=JSON.parse(e);else if(e instanceof ArrayBuffer)if(r.decode(new Uint8Array(e,0,4))===BINARY_EXTENSION_HEADER_MAGIC){try{i[EXTENSIONS.KHR_BINARY_GLTF]=new GLTFBinaryExtension(e)}catch(u){n&&n(u);return}o=JSON.parse(i[EXTENSIONS.KHR_BINARY_GLTF].content)}else o=JSON.parse(r.decode(e));else o=e;if(o.asset===void 0||o.asset.version[0]<2){n&&n(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));return}const c=new GLTFParser(o,{path:t||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});c.fileLoader.setRequestHeader(this.requestHeader);for(let h=0;h<this.pluginCallbacks.length;h++){const u=this.pluginCallbacks[h](c);u.name||console.error("THREE.GLTFLoader: Invalid plugin found: missing name"),l[u.name]=u,i[u.name]=!0}if(o.extensionsUsed)for(let h=0;h<o.extensionsUsed.length;++h){const u=o.extensionsUsed[h],d=o.extensionsRequired||[];switch(u){case EXTENSIONS.KHR_MATERIALS_UNLIT:i[u]=new GLTFMaterialsUnlitExtension;break;case EXTENSIONS.KHR_DRACO_MESH_COMPRESSION:i[u]=new GLTFDracoMeshCompressionExtension(o,this.dracoLoader);break;case EXTENSIONS.KHR_TEXTURE_TRANSFORM:i[u]=new GLTFTextureTransformExtension;break;case EXTENSIONS.KHR_MESH_QUANTIZATION:i[u]=new GLTFMeshQuantizationExtension;break;default:d.indexOf(u)>=0&&l[u]===void 0&&console.warn('THREE.GLTFLoader: Unknown extension "'+u+'".')}}c.setExtensions(i),c.setPlugins(l),c.parse(s,n)}parseAsync(e,t){const s=this;return new Promise(function(n,o){s.parse(e,t,n,o)})}}function GLTFRegistry(){let a={};return{get:function(e){return a[e]},add:function(e,t){a[e]=t},remove:function(e){delete a[e]},removeAll:function(){a={}}}}const EXTENSIONS={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_DISPERSION:"KHR_materials_dispersion",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_ANISOTROPY:"KHR_materials_anisotropy",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_MATERIALS_BUMP:"EXT_materials_bump",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_TEXTURE_AVIF:"EXT_texture_avif",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",EXT_MESH_GPU_INSTANCING:"EXT_mesh_gpu_instancing"};class GLTFLightsExtension{constructor(e){this.parser=e,this.name=EXTENSIONS.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const e=this.parser,t=this.parser.json.nodes||[];for(let s=0,n=t.length;s<n;s++){const o=t[s];o.extensions&&o.extensions[this.name]&&o.extensions[this.name].light!==void 0&&e._addNodeRef(this.cache,o.extensions[this.name].light)}}_loadLight(e){const t=this.parser,s="light:"+e;let n=t.cache.get(s);if(n)return n;const o=t.json,r=((o.extensions&&o.extensions[this.name]||{}).lights||[])[e];let c;const h=new Color(16777215);r.color!==void 0&&h.setRGB(r.color[0],r.color[1],r.color[2],LinearSRGBColorSpace);const u=r.range!==void 0?r.range:0;switch(r.type){case"directional":c=new DirectionalLight(h),c.target.position.set(0,0,-1),c.add(c.target);break;case"point":c=new PointLight(h),c.distance=u;break;case"spot":c=new SpotLight(h),c.distance=u,r.spot=r.spot||{},r.spot.innerConeAngle=r.spot.innerConeAngle!==void 0?r.spot.innerConeAngle:0,r.spot.outerConeAngle=r.spot.outerConeAngle!==void 0?r.spot.outerConeAngle:Math.PI/4,c.angle=r.spot.outerConeAngle,c.penumbra=1-r.spot.innerConeAngle/r.spot.outerConeAngle,c.target.position.set(0,0,-1),c.add(c.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+r.type)}return c.position.set(0,0,0),c.decay=2,assignExtrasToUserData(c,r),r.intensity!==void 0&&(c.intensity=r.intensity),c.name=t.createUniqueName(r.name||"light_"+e),n=Promise.resolve(c),t.cache.add(s,n),n}getDependency(e,t){if(e==="light")return this._loadLight(t)}createNodeAttachment(e){const t=this,s=this.parser,o=s.json.nodes[e],l=(o.extensions&&o.extensions[this.name]||{}).light;return l===void 0?null:this._loadLight(l).then(function(r){return s._getNodeRef(t.cache,l,r)})}}class GLTFMaterialsUnlitExtension{constructor(){this.name=EXTENSIONS.KHR_MATERIALS_UNLIT}getMaterialType(){return MeshBasicMaterial}extendParams(e,t,s){const n=[];e.color=new Color(1,1,1),e.opacity=1;const o=t.pbrMetallicRoughness;if(o){if(Array.isArray(o.baseColorFactor)){const i=o.baseColorFactor;e.color.setRGB(i[0],i[1],i[2],LinearSRGBColorSpace),e.opacity=i[3]}o.baseColorTexture!==void 0&&n.push(s.assignTexture(e,"map",o.baseColorTexture,SRGBColorSpace))}return Promise.all(n)}}class GLTFMaterialsEmissiveStrengthExtension{constructor(e){this.parser=e,this.name=EXTENSIONS.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(e,t){const n=this.parser.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const o=n.extensions[this.name].emissiveStrength;return o!==void 0&&(t.emissiveIntensity=o),Promise.resolve()}}class GLTFMaterialsClearcoatExtension{constructor(e){this.parser=e,this.name=EXTENSIONS.KHR_MATERIALS_CLEARCOAT}getMaterialType(e){const s=this.parser.json.materials[e];return!s.extensions||!s.extensions[this.name]?null:MeshPhysicalMaterial}extendMaterialParams(e,t){const s=this.parser,n=s.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const o=[],i=n.extensions[this.name];if(i.clearcoatFactor!==void 0&&(t.clearcoat=i.clearcoatFactor),i.clearcoatTexture!==void 0&&o.push(s.assignTexture(t,"clearcoatMap",i.clearcoatTexture)),i.clearcoatRoughnessFactor!==void 0&&(t.clearcoatRoughness=i.clearcoatRoughnessFactor),i.clearcoatRoughnessTexture!==void 0&&o.push(s.assignTexture(t,"clearcoatRoughnessMap",i.clearcoatRoughnessTexture)),i.clearcoatNormalTexture!==void 0&&(o.push(s.assignTexture(t,"clearcoatNormalMap",i.clearcoatNormalTexture)),i.clearcoatNormalTexture.scale!==void 0)){const l=i.clearcoatNormalTexture.scale;t.clearcoatNormalScale=new Vector2(l,l)}return Promise.all(o)}}class GLTFMaterialsDispersionExtension{constructor(e){this.parser=e,this.name=EXTENSIONS.KHR_MATERIALS_DISPERSION}getMaterialType(e){const s=this.parser.json.materials[e];return!s.extensions||!s.extensions[this.name]?null:MeshPhysicalMaterial}extendMaterialParams(e,t){const n=this.parser.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const o=n.extensions[this.name];return t.dispersion=o.dispersion!==void 0?o.dispersion:0,Promise.resolve()}}class GLTFMaterialsIridescenceExtension{constructor(e){this.parser=e,this.name=EXTENSIONS.KHR_MATERIALS_IRIDESCENCE}getMaterialType(e){const s=this.parser.json.materials[e];return!s.extensions||!s.extensions[this.name]?null:MeshPhysicalMaterial}extendMaterialParams(e,t){const s=this.parser,n=s.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const o=[],i=n.extensions[this.name];return i.iridescenceFactor!==void 0&&(t.iridescence=i.iridescenceFactor),i.iridescenceTexture!==void 0&&o.push(s.assignTexture(t,"iridescenceMap",i.iridescenceTexture)),i.iridescenceIor!==void 0&&(t.iridescenceIOR=i.iridescenceIor),t.iridescenceThicknessRange===void 0&&(t.iridescenceThicknessRange=[100,400]),i.iridescenceThicknessMinimum!==void 0&&(t.iridescenceThicknessRange[0]=i.iridescenceThicknessMinimum),i.iridescenceThicknessMaximum!==void 0&&(t.iridescenceThicknessRange[1]=i.iridescenceThicknessMaximum),i.iridescenceThicknessTexture!==void 0&&o.push(s.assignTexture(t,"iridescenceThicknessMap",i.iridescenceThicknessTexture)),Promise.all(o)}}class GLTFMaterialsSheenExtension{constructor(e){this.parser=e,this.name=EXTENSIONS.KHR_MATERIALS_SHEEN}getMaterialType(e){const s=this.parser.json.materials[e];return!s.extensions||!s.extensions[this.name]?null:MeshPhysicalMaterial}extendMaterialParams(e,t){const s=this.parser,n=s.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const o=[];t.sheenColor=new Color(0,0,0),t.sheenRoughness=0,t.sheen=1;const i=n.extensions[this.name];if(i.sheenColorFactor!==void 0){const l=i.sheenColorFactor;t.sheenColor.setRGB(l[0],l[1],l[2],LinearSRGBColorSpace)}return i.sheenRoughnessFactor!==void 0&&(t.sheenRoughness=i.sheenRoughnessFactor),i.sheenColorTexture!==void 0&&o.push(s.assignTexture(t,"sheenColorMap",i.sheenColorTexture,SRGBColorSpace)),i.sheenRoughnessTexture!==void 0&&o.push(s.assignTexture(t,"sheenRoughnessMap",i.sheenRoughnessTexture)),Promise.all(o)}}class GLTFMaterialsTransmissionExtension{constructor(e){this.parser=e,this.name=EXTENSIONS.KHR_MATERIALS_TRANSMISSION}getMaterialType(e){const s=this.parser.json.materials[e];return!s.extensions||!s.extensions[this.name]?null:MeshPhysicalMaterial}extendMaterialParams(e,t){const s=this.parser,n=s.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const o=[],i=n.extensions[this.name];return i.transmissionFactor!==void 0&&(t.transmission=i.transmissionFactor),i.transmissionTexture!==void 0&&o.push(s.assignTexture(t,"transmissionMap",i.transmissionTexture)),Promise.all(o)}}class GLTFMaterialsVolumeExtension{constructor(e){this.parser=e,this.name=EXTENSIONS.KHR_MATERIALS_VOLUME}getMaterialType(e){const s=this.parser.json.materials[e];return!s.extensions||!s.extensions[this.name]?null:MeshPhysicalMaterial}extendMaterialParams(e,t){const s=this.parser,n=s.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const o=[],i=n.extensions[this.name];t.thickness=i.thicknessFactor!==void 0?i.thicknessFactor:0,i.thicknessTexture!==void 0&&o.push(s.assignTexture(t,"thicknessMap",i.thicknessTexture)),t.attenuationDistance=i.attenuationDistance||1/0;const l=i.attenuationColor||[1,1,1];return t.attenuationColor=new Color().setRGB(l[0],l[1],l[2],LinearSRGBColorSpace),Promise.all(o)}}class GLTFMaterialsIorExtension{constructor(e){this.parser=e,this.name=EXTENSIONS.KHR_MATERIALS_IOR}getMaterialType(e){const s=this.parser.json.materials[e];return!s.extensions||!s.extensions[this.name]?null:MeshPhysicalMaterial}extendMaterialParams(e,t){const n=this.parser.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const o=n.extensions[this.name];return t.ior=o.ior!==void 0?o.ior:1.5,Promise.resolve()}}class GLTFMaterialsSpecularExtension{constructor(e){this.parser=e,this.name=EXTENSIONS.KHR_MATERIALS_SPECULAR}getMaterialType(e){const s=this.parser.json.materials[e];return!s.extensions||!s.extensions[this.name]?null:MeshPhysicalMaterial}extendMaterialParams(e,t){const s=this.parser,n=s.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const o=[],i=n.extensions[this.name];t.specularIntensity=i.specularFactor!==void 0?i.specularFactor:1,i.specularTexture!==void 0&&o.push(s.assignTexture(t,"specularIntensityMap",i.specularTexture));const l=i.specularColorFactor||[1,1,1];return t.specularColor=new Color().setRGB(l[0],l[1],l[2],LinearSRGBColorSpace),i.specularColorTexture!==void 0&&o.push(s.assignTexture(t,"specularColorMap",i.specularColorTexture,SRGBColorSpace)),Promise.all(o)}}class GLTFMaterialsBumpExtension{constructor(e){this.parser=e,this.name=EXTENSIONS.EXT_MATERIALS_BUMP}getMaterialType(e){const s=this.parser.json.materials[e];return!s.extensions||!s.extensions[this.name]?null:MeshPhysicalMaterial}extendMaterialParams(e,t){const s=this.parser,n=s.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const o=[],i=n.extensions[this.name];return t.bumpScale=i.bumpFactor!==void 0?i.bumpFactor:1,i.bumpTexture!==void 0&&o.push(s.assignTexture(t,"bumpMap",i.bumpTexture)),Promise.all(o)}}class GLTFMaterialsAnisotropyExtension{constructor(e){this.parser=e,this.name=EXTENSIONS.KHR_MATERIALS_ANISOTROPY}getMaterialType(e){const s=this.parser.json.materials[e];return!s.extensions||!s.extensions[this.name]?null:MeshPhysicalMaterial}extendMaterialParams(e,t){const s=this.parser,n=s.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const o=[],i=n.extensions[this.name];return i.anisotropyStrength!==void 0&&(t.anisotropy=i.anisotropyStrength),i.anisotropyRotation!==void 0&&(t.anisotropyRotation=i.anisotropyRotation),i.anisotropyTexture!==void 0&&o.push(s.assignTexture(t,"anisotropyMap",i.anisotropyTexture)),Promise.all(o)}}class GLTFTextureBasisUExtension{constructor(e){this.parser=e,this.name=EXTENSIONS.KHR_TEXTURE_BASISU}loadTexture(e){const t=this.parser,s=t.json,n=s.textures[e];if(!n.extensions||!n.extensions[this.name])return null;const o=n.extensions[this.name],i=t.options.ktx2Loader;if(!i){if(s.extensionsRequired&&s.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return t.loadTextureImage(e,o.source,i)}}class GLTFTextureWebPExtension{constructor(e){this.parser=e,this.name=EXTENSIONS.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(e){const t=this.name,s=this.parser,n=s.json,o=n.textures[e];if(!o.extensions||!o.extensions[t])return null;const i=o.extensions[t],l=n.images[i.source];let r=s.textureLoader;if(l.uri){const c=s.options.manager.getHandler(l.uri);c!==null&&(r=c)}return this.detectSupport().then(function(c){if(c)return s.loadTextureImage(e,i.source,r);if(n.extensionsRequired&&n.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return s.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const t=new Image;t.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",t.onload=t.onerror=function(){e(t.height===1)}})),this.isSupported}}class GLTFTextureAVIFExtension{constructor(e){this.parser=e,this.name=EXTENSIONS.EXT_TEXTURE_AVIF,this.isSupported=null}loadTexture(e){const t=this.name,s=this.parser,n=s.json,o=n.textures[e];if(!o.extensions||!o.extensions[t])return null;const i=o.extensions[t],l=n.images[i.source];let r=s.textureLoader;if(l.uri){const c=s.options.manager.getHandler(l.uri);c!==null&&(r=c)}return this.detectSupport().then(function(c){if(c)return s.loadTextureImage(e,i.source,r);if(n.extensionsRequired&&n.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: AVIF required by asset but unsupported.");return s.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const t=new Image;t.src="data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAABcAAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAEAAAABAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQAMAAAAABNjb2xybmNseAACAAIABoAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAAB9tZGF0EgAKCBgABogQEDQgMgkQAAAAB8dSLfI=",t.onload=t.onerror=function(){e(t.height===1)}})),this.isSupported}}class GLTFMeshoptCompression{constructor(e){this.name=EXTENSIONS.EXT_MESHOPT_COMPRESSION,this.parser=e}loadBufferView(e){const t=this.parser.json,s=t.bufferViews[e];if(s.extensions&&s.extensions[this.name]){const n=s.extensions[this.name],o=this.parser.getDependency("buffer",n.buffer),i=this.parser.options.meshoptDecoder;if(!i||!i.supported){if(t.extensionsRequired&&t.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return o.then(function(l){const r=n.byteOffset||0,c=n.byteLength||0,h=n.count,u=n.byteStride,d=new Uint8Array(l,r,c);return i.decodeGltfBufferAsync?i.decodeGltfBufferAsync(h,u,d,n.mode,n.filter).then(function(p){return p.buffer}):i.ready.then(function(){const p=new ArrayBuffer(h*u);return i.decodeGltfBuffer(new Uint8Array(p),h,u,d,n.mode,n.filter),p})})}else return null}}class GLTFMeshGpuInstancing{constructor(e){this.name=EXTENSIONS.EXT_MESH_GPU_INSTANCING,this.parser=e}createNodeMesh(e){const t=this.parser.json,s=t.nodes[e];if(!s.extensions||!s.extensions[this.name]||s.mesh===void 0)return null;const n=t.meshes[s.mesh];for(const c of n.primitives)if(c.mode!==WEBGL_CONSTANTS.TRIANGLES&&c.mode!==WEBGL_CONSTANTS.TRIANGLE_STRIP&&c.mode!==WEBGL_CONSTANTS.TRIANGLE_FAN&&c.mode!==void 0)return null;const i=s.extensions[this.name].attributes,l=[],r={};for(const c in i)l.push(this.parser.getDependency("accessor",i[c]).then(h=>(r[c]=h,r[c])));return l.length<1?null:(l.push(this.parser.createNodeMesh(e)),Promise.all(l).then(c=>{const h=c.pop(),u=h.isGroup?h.children:[h],d=c[0].count,p=[];for(const f of u){const _=new Matrix4,m=new Vector3,g=new Quaternion,T=new Vector3(1,1,1),S=new InstancedMesh(f.geometry,f.material,d);for(let y=0;y<d;y++)r.TRANSLATION&&m.fromBufferAttribute(r.TRANSLATION,y),r.ROTATION&&g.fromBufferAttribute(r.ROTATION,y),r.SCALE&&T.fromBufferAttribute(r.SCALE,y),S.setMatrixAt(y,_.compose(m,g,T));for(const y in r)if(y==="_COLOR_0"){const b=r[y];S.instanceColor=new InstancedBufferAttribute(b.array,b.itemSize,b.normalized)}else y!=="TRANSLATION"&&y!=="ROTATION"&&y!=="SCALE"&&f.geometry.setAttribute(y,r[y]);Object3D.prototype.copy.call(S,f),this.parser.assignFinalMaterial(S),p.push(S)}return h.isGroup?(h.clear(),h.add(...p),h):p[0]}))}}const BINARY_EXTENSION_HEADER_MAGIC="glTF",BINARY_EXTENSION_HEADER_LENGTH=12,BINARY_EXTENSION_CHUNK_TYPES={JSON:1313821514,BIN:5130562};class GLTFBinaryExtension{constructor(e){this.name=EXTENSIONS.KHR_BINARY_GLTF,this.content=null,this.body=null;const t=new DataView(e,0,BINARY_EXTENSION_HEADER_LENGTH),s=new TextDecoder;if(this.header={magic:s.decode(new Uint8Array(e.slice(0,4))),version:t.getUint32(4,!0),length:t.getUint32(8,!0)},this.header.magic!==BINARY_EXTENSION_HEADER_MAGIC)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const n=this.header.length-BINARY_EXTENSION_HEADER_LENGTH,o=new DataView(e,BINARY_EXTENSION_HEADER_LENGTH);let i=0;for(;i<n;){const l=o.getUint32(i,!0);i+=4;const r=o.getUint32(i,!0);if(i+=4,r===BINARY_EXTENSION_CHUNK_TYPES.JSON){const c=new Uint8Array(e,BINARY_EXTENSION_HEADER_LENGTH+i,l);this.content=s.decode(c)}else if(r===BINARY_EXTENSION_CHUNK_TYPES.BIN){const c=BINARY_EXTENSION_HEADER_LENGTH+i;this.body=e.slice(c,c+l)}i+=l}if(this.content===null)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class GLTFDracoMeshCompressionExtension{constructor(e,t){if(!t)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=EXTENSIONS.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=t,this.dracoLoader.preload()}decodePrimitive(e,t){const s=this.json,n=this.dracoLoader,o=e.extensions[this.name].bufferView,i=e.extensions[this.name].attributes,l={},r={},c={};for(const h in i){const u=ATTRIBUTES[h]||h.toLowerCase();l[u]=i[h]}for(const h in e.attributes){const u=ATTRIBUTES[h]||h.toLowerCase();if(i[h]!==void 0){const d=s.accessors[e.attributes[h]],p=WEBGL_COMPONENT_TYPES[d.componentType];c[u]=p.name,r[u]=d.normalized===!0}}return t.getDependency("bufferView",o).then(function(h){return new Promise(function(u,d){n.decodeDracoFile(h,function(p){for(const f in p.attributes){const _=p.attributes[f],m=r[f];m!==void 0&&(_.normalized=m)}u(p)},l,c,LinearSRGBColorSpace,d)})})}}class GLTFTextureTransformExtension{constructor(){this.name=EXTENSIONS.KHR_TEXTURE_TRANSFORM}extendTexture(e,t){return(t.texCoord===void 0||t.texCoord===e.channel)&&t.offset===void 0&&t.rotation===void 0&&t.scale===void 0||(e=e.clone(),t.texCoord!==void 0&&(e.channel=t.texCoord),t.offset!==void 0&&e.offset.fromArray(t.offset),t.rotation!==void 0&&(e.rotation=t.rotation),t.scale!==void 0&&e.repeat.fromArray(t.scale),e.needsUpdate=!0),e}}class GLTFMeshQuantizationExtension{constructor(){this.name=EXTENSIONS.KHR_MESH_QUANTIZATION}}class GLTFCubicSplineInterpolant extends Interpolant{constructor(e,t,s,n){super(e,t,s,n)}copySampleValue_(e){const t=this.resultBuffer,s=this.sampleValues,n=this.valueSize,o=e*n*3+n;for(let i=0;i!==n;i++)t[i]=s[o+i];return t}interpolate_(e,t,s,n){const o=this.resultBuffer,i=this.sampleValues,l=this.valueSize,r=l*2,c=l*3,h=n-t,u=(s-t)/h,d=u*u,p=d*u,f=e*c,_=f-c,m=-2*p+3*d,g=p-d,T=1-m,S=g-d+u;for(let y=0;y!==l;y++){const b=i[_+y+l],A=i[_+y+r]*h,E=i[f+y+l],w=i[f+y]*h;o[y]=T*b+S*A+m*E+g*w}return o}}const _q=new Quaternion;class GLTFCubicSplineQuaternionInterpolant extends GLTFCubicSplineInterpolant{interpolate_(e,t,s,n){const o=super.interpolate_(e,t,s,n);return _q.fromArray(o).normalize().toArray(o),o}}const WEBGL_CONSTANTS={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123},WEBGL_COMPONENT_TYPES={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},WEBGL_FILTERS={9728:NearestFilter,9729:LinearFilter,9984:NearestMipmapNearestFilter,9985:LinearMipmapNearestFilter,9986:NearestMipmapLinearFilter,9987:LinearMipmapLinearFilter},WEBGL_WRAPPINGS={33071:ClampToEdgeWrapping,33648:MirroredRepeatWrapping,10497:RepeatWrapping},WEBGL_TYPE_SIZES={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},ATTRIBUTES={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv1",TEXCOORD_2:"uv2",TEXCOORD_3:"uv3",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},PATH_PROPERTIES={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},INTERPOLATION={CUBICSPLINE:void 0,LINEAR:InterpolateLinear,STEP:InterpolateDiscrete},ALPHA_MODES={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};function createDefaultMaterial(a){return a.DefaultMaterial===void 0&&(a.DefaultMaterial=new MeshStandardMaterial({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:FrontSide})),a.DefaultMaterial}function addUnknownExtensionsToUserData(a,e,t){for(const s in t.extensions)a[s]===void 0&&(e.userData.gltfExtensions=e.userData.gltfExtensions||{},e.userData.gltfExtensions[s]=t.extensions[s])}function assignExtrasToUserData(a,e){e.extras!==void 0&&(typeof e.extras=="object"?Object.assign(a.userData,e.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+e.extras))}function addMorphTargets(a,e,t){let s=!1,n=!1,o=!1;for(let c=0,h=e.length;c<h;c++){const u=e[c];if(u.POSITION!==void 0&&(s=!0),u.NORMAL!==void 0&&(n=!0),u.COLOR_0!==void 0&&(o=!0),s&&n&&o)break}if(!s&&!n&&!o)return Promise.resolve(a);const i=[],l=[],r=[];for(let c=0,h=e.length;c<h;c++){const u=e[c];if(s){const d=u.POSITION!==void 0?t.getDependency("accessor",u.POSITION):a.attributes.position;i.push(d)}if(n){const d=u.NORMAL!==void 0?t.getDependency("accessor",u.NORMAL):a.attributes.normal;l.push(d)}if(o){const d=u.COLOR_0!==void 0?t.getDependency("accessor",u.COLOR_0):a.attributes.color;r.push(d)}}return Promise.all([Promise.all(i),Promise.all(l),Promise.all(r)]).then(function(c){const h=c[0],u=c[1],d=c[2];return s&&(a.morphAttributes.position=h),n&&(a.morphAttributes.normal=u),o&&(a.morphAttributes.color=d),a.morphTargetsRelative=!0,a})}function updateMorphTargets(a,e){if(a.updateMorphTargets(),e.weights!==void 0)for(let t=0,s=e.weights.length;t<s;t++)a.morphTargetInfluences[t]=e.weights[t];if(e.extras&&Array.isArray(e.extras.targetNames)){const t=e.extras.targetNames;if(a.morphTargetInfluences.length===t.length){a.morphTargetDictionary={};for(let s=0,n=t.length;s<n;s++)a.morphTargetDictionary[t[s]]=s}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function createPrimitiveKey(a){let e;const t=a.extensions&&a.extensions[EXTENSIONS.KHR_DRACO_MESH_COMPRESSION];if(t?e="draco:"+t.bufferView+":"+t.indices+":"+createAttributesKey(t.attributes):e=a.indices+":"+createAttributesKey(a.attributes)+":"+a.mode,a.targets!==void 0)for(let s=0,n=a.targets.length;s<n;s++)e+=":"+createAttributesKey(a.targets[s]);return e}function createAttributesKey(a){let e="";const t=Object.keys(a).sort();for(let s=0,n=t.length;s<n;s++)e+=t[s]+":"+a[t[s]]+";";return e}function getNormalizedComponentScale(a){switch(a){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}function getImageURIMimeType(a){return a.search(/\.jpe?g($|\?)/i)>0||a.search(/^data\:image\/jpeg/)===0?"image/jpeg":a.search(/\.webp($|\?)/i)>0||a.search(/^data\:image\/webp/)===0?"image/webp":a.search(/\.ktx2($|\?)/i)>0||a.search(/^data\:image\/ktx2/)===0?"image/ktx2":"image/png"}const _identityMatrix=new Matrix4;class GLTFParser{constructor(e={},t={}){this.json=e,this.extensions={},this.plugins={},this.options=t,this.cache=new GLTFRegistry,this.associations=new Map,this.primitiveCache={},this.nodeCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};let s=!1,n=-1,o=!1,i=-1;if(typeof navigator<"u"){const l=navigator.userAgent;s=/^((?!chrome|android).)*safari/i.test(l)===!0;const r=l.match(/Version\/(\d+)/);n=s&&r?parseInt(r[1],10):-1,o=l.indexOf("Firefox")>-1,i=o?l.match(/Firefox\/([0-9]+)\./)[1]:-1}typeof createImageBitmap>"u"||s&&n<17||o&&i<98?this.textureLoader=new TextureLoader(this.options.manager):this.textureLoader=new ImageBitmapLoader(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new FileLoader(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),this.options.crossOrigin==="use-credentials"&&this.fileLoader.setWithCredentials(!0)}setExtensions(e){this.extensions=e}setPlugins(e){this.plugins=e}parse(e,t){const s=this,n=this.json,o=this.extensions;this.cache.removeAll(),this.nodeCache={},this._invokeAll(function(i){return i._markDefs&&i._markDefs()}),Promise.all(this._invokeAll(function(i){return i.beforeRoot&&i.beforeRoot()})).then(function(){return Promise.all([s.getDependencies("scene"),s.getDependencies("animation"),s.getDependencies("camera")])}).then(function(i){const l={scene:i[0][n.scene||0],scenes:i[0],animations:i[1],cameras:i[2],asset:n.asset,parser:s,userData:{}};return addUnknownExtensionsToUserData(o,l,n),assignExtrasToUserData(l,n),Promise.all(s._invokeAll(function(r){return r.afterRoot&&r.afterRoot(l)})).then(function(){for(const r of l.scenes)r.updateMatrixWorld();e(l)})}).catch(t)}_markDefs(){const e=this.json.nodes||[],t=this.json.skins||[],s=this.json.meshes||[];for(let n=0,o=t.length;n<o;n++){const i=t[n].joints;for(let l=0,r=i.length;l<r;l++)e[i[l]].isBone=!0}for(let n=0,o=e.length;n<o;n++){const i=e[n];i.mesh!==void 0&&(this._addNodeRef(this.meshCache,i.mesh),i.skin!==void 0&&(s[i.mesh].isSkinnedMesh=!0)),i.camera!==void 0&&this._addNodeRef(this.cameraCache,i.camera)}}_addNodeRef(e,t){t!==void 0&&(e.refs[t]===void 0&&(e.refs[t]=e.uses[t]=0),e.refs[t]++)}_getNodeRef(e,t,s){if(e.refs[t]<=1)return s;const n=s.clone(),o=(i,l)=>{const r=this.associations.get(i);r!=null&&this.associations.set(l,r);for(const[c,h]of i.children.entries())o(h,l.children[c])};return o(s,n),n.name+="_instance_"+e.uses[t]++,n}_invokeOne(e){const t=Object.values(this.plugins);t.push(this);for(let s=0;s<t.length;s++){const n=e(t[s]);if(n)return n}return null}_invokeAll(e){const t=Object.values(this.plugins);t.unshift(this);const s=[];for(let n=0;n<t.length;n++){const o=e(t[n]);o&&s.push(o)}return s}getDependency(e,t){const s=e+":"+t;let n=this.cache.get(s);if(!n){switch(e){case"scene":n=this.loadScene(t);break;case"node":n=this._invokeOne(function(o){return o.loadNode&&o.loadNode(t)});break;case"mesh":n=this._invokeOne(function(o){return o.loadMesh&&o.loadMesh(t)});break;case"accessor":n=this.loadAccessor(t);break;case"bufferView":n=this._invokeOne(function(o){return o.loadBufferView&&o.loadBufferView(t)});break;case"buffer":n=this.loadBuffer(t);break;case"material":n=this._invokeOne(function(o){return o.loadMaterial&&o.loadMaterial(t)});break;case"texture":n=this._invokeOne(function(o){return o.loadTexture&&o.loadTexture(t)});break;case"skin":n=this.loadSkin(t);break;case"animation":n=this._invokeOne(function(o){return o.loadAnimation&&o.loadAnimation(t)});break;case"camera":n=this.loadCamera(t);break;default:if(n=this._invokeOne(function(o){return o!=this&&o.getDependency&&o.getDependency(e,t)}),!n)throw new Error("Unknown type: "+e);break}this.cache.add(s,n)}return n}getDependencies(e){let t=this.cache.get(e);if(!t){const s=this,n=this.json[e+(e==="mesh"?"es":"s")]||[];t=Promise.all(n.map(function(o,i){return s.getDependency(e,i)})),this.cache.add(e,t)}return t}loadBuffer(e){const t=this.json.buffers[e],s=this.fileLoader;if(t.type&&t.type!=="arraybuffer")throw new Error("THREE.GLTFLoader: "+t.type+" buffer type is not supported.");if(t.uri===void 0&&e===0)return Promise.resolve(this.extensions[EXTENSIONS.KHR_BINARY_GLTF].body);const n=this.options;return new Promise(function(o,i){s.load(LoaderUtils.resolveURL(t.uri,n.path),o,void 0,function(){i(new Error('THREE.GLTFLoader: Failed to load buffer "'+t.uri+'".'))})})}loadBufferView(e){const t=this.json.bufferViews[e];return this.getDependency("buffer",t.buffer).then(function(s){const n=t.byteLength||0,o=t.byteOffset||0;return s.slice(o,o+n)})}loadAccessor(e){const t=this,s=this.json,n=this.json.accessors[e];if(n.bufferView===void 0&&n.sparse===void 0){const i=WEBGL_TYPE_SIZES[n.type],l=WEBGL_COMPONENT_TYPES[n.componentType],r=n.normalized===!0,c=new l(n.count*i);return Promise.resolve(new BufferAttribute(c,i,r))}const o=[];return n.bufferView!==void 0?o.push(this.getDependency("bufferView",n.bufferView)):o.push(null),n.sparse!==void 0&&(o.push(this.getDependency("bufferView",n.sparse.indices.bufferView)),o.push(this.getDependency("bufferView",n.sparse.values.bufferView))),Promise.all(o).then(function(i){const l=i[0],r=WEBGL_TYPE_SIZES[n.type],c=WEBGL_COMPONENT_TYPES[n.componentType],h=c.BYTES_PER_ELEMENT,u=h*r,d=n.byteOffset||0,p=n.bufferView!==void 0?s.bufferViews[n.bufferView].byteStride:void 0,f=n.normalized===!0;let _,m;if(p&&p!==u){const g=Math.floor(d/p),T="InterleavedBuffer:"+n.bufferView+":"+n.componentType+":"+g+":"+n.count;let S=t.cache.get(T);S||(_=new c(l,g*p,n.count*p/h),S=new InterleavedBuffer(_,p/h),t.cache.add(T,S)),m=new InterleavedBufferAttribute(S,r,d%p/h,f)}else l===null?_=new c(n.count*r):_=new c(l,d,n.count*r),m=new BufferAttribute(_,r,f);if(n.sparse!==void 0){const g=WEBGL_TYPE_SIZES.SCALAR,T=WEBGL_COMPONENT_TYPES[n.sparse.indices.componentType],S=n.sparse.indices.byteOffset||0,y=n.sparse.values.byteOffset||0,b=new T(i[1],S,n.sparse.count*g),A=new c(i[2],y,n.sparse.count*r);l!==null&&(m=new BufferAttribute(m.array.slice(),m.itemSize,m.normalized)),m.normalized=!1;for(let E=0,w=b.length;E<w;E++){const x=b[E];if(m.setX(x,A[E*r]),r>=2&&m.setY(x,A[E*r+1]),r>=3&&m.setZ(x,A[E*r+2]),r>=4&&m.setW(x,A[E*r+3]),r>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}m.normalized=f}return m})}loadTexture(e){const t=this.json,s=this.options,o=t.textures[e].source,i=t.images[o];let l=this.textureLoader;if(i.uri){const r=s.manager.getHandler(i.uri);r!==null&&(l=r)}return this.loadTextureImage(e,o,l)}loadTextureImage(e,t,s){const n=this,o=this.json,i=o.textures[e],l=o.images[t],r=(l.uri||l.bufferView)+":"+i.sampler;if(this.textureCache[r])return this.textureCache[r];const c=this.loadImageSource(t,s).then(function(h){h.flipY=!1,h.name=i.name||l.name||"",h.name===""&&typeof l.uri=="string"&&l.uri.startsWith("data:image/")===!1&&(h.name=l.uri);const d=(o.samplers||{})[i.sampler]||{};return h.magFilter=WEBGL_FILTERS[d.magFilter]||LinearFilter,h.minFilter=WEBGL_FILTERS[d.minFilter]||LinearMipmapLinearFilter,h.wrapS=WEBGL_WRAPPINGS[d.wrapS]||RepeatWrapping,h.wrapT=WEBGL_WRAPPINGS[d.wrapT]||RepeatWrapping,h.generateMipmaps=!h.isCompressedTexture&&h.minFilter!==NearestFilter&&h.minFilter!==LinearFilter,n.associations.set(h,{textures:e}),h}).catch(function(){return null});return this.textureCache[r]=c,c}loadImageSource(e,t){const s=this,n=this.json,o=this.options;if(this.sourceCache[e]!==void 0)return this.sourceCache[e].then(u=>u.clone());const i=n.images[e],l=self.URL||self.webkitURL;let r=i.uri||"",c=!1;if(i.bufferView!==void 0)r=s.getDependency("bufferView",i.bufferView).then(function(u){c=!0;const d=new Blob([u],{type:i.mimeType});return r=l.createObjectURL(d),r});else if(i.uri===void 0)throw new Error("THREE.GLTFLoader: Image "+e+" is missing URI and bufferView");const h=Promise.resolve(r).then(function(u){return new Promise(function(d,p){let f=d;t.isImageBitmapLoader===!0&&(f=function(_){const m=new Texture(_);m.needsUpdate=!0,d(m)}),t.load(LoaderUtils.resolveURL(u,o.path),f,void 0,p)})}).then(function(u){return c===!0&&l.revokeObjectURL(r),assignExtrasToUserData(u,i),u.userData.mimeType=i.mimeType||getImageURIMimeType(i.uri),u}).catch(function(u){throw console.error("THREE.GLTFLoader: Couldn't load texture",r),u});return this.sourceCache[e]=h,h}assignTexture(e,t,s,n){const o=this;return this.getDependency("texture",s.index).then(function(i){if(!i)return null;if(s.texCoord!==void 0&&s.texCoord>0&&(i=i.clone(),i.channel=s.texCoord),o.extensions[EXTENSIONS.KHR_TEXTURE_TRANSFORM]){const l=s.extensions!==void 0?s.extensions[EXTENSIONS.KHR_TEXTURE_TRANSFORM]:void 0;if(l){const r=o.associations.get(i);i=o.extensions[EXTENSIONS.KHR_TEXTURE_TRANSFORM].extendTexture(i,l),o.associations.set(i,r)}}return n!==void 0&&(i.colorSpace=n),e[t]=i,i})}assignFinalMaterial(e){const t=e.geometry;let s=e.material;const n=t.attributes.tangent===void 0,o=t.attributes.color!==void 0,i=t.attributes.normal===void 0;if(e.isPoints){const l="PointsMaterial:"+s.uuid;let r=this.cache.get(l);r||(r=new PointsMaterial,Material.prototype.copy.call(r,s),r.color.copy(s.color),r.map=s.map,r.sizeAttenuation=!1,this.cache.add(l,r)),s=r}else if(e.isLine){const l="LineBasicMaterial:"+s.uuid;let r=this.cache.get(l);r||(r=new LineBasicMaterial,Material.prototype.copy.call(r,s),r.color.copy(s.color),r.map=s.map,this.cache.add(l,r)),s=r}if(n||o||i){let l="ClonedMaterial:"+s.uuid+":";n&&(l+="derivative-tangents:"),o&&(l+="vertex-colors:"),i&&(l+="flat-shading:");let r=this.cache.get(l);r||(r=s.clone(),o&&(r.vertexColors=!0),i&&(r.flatShading=!0),n&&(r.normalScale&&(r.normalScale.y*=-1),r.clearcoatNormalScale&&(r.clearcoatNormalScale.y*=-1)),this.cache.add(l,r),this.associations.set(r,this.associations.get(s))),s=r}e.material=s}getMaterialType(){return MeshStandardMaterial}loadMaterial(e){const t=this,s=this.json,n=this.extensions,o=s.materials[e];let i;const l={},r=o.extensions||{},c=[];if(r[EXTENSIONS.KHR_MATERIALS_UNLIT]){const u=n[EXTENSIONS.KHR_MATERIALS_UNLIT];i=u.getMaterialType(),c.push(u.extendParams(l,o,t))}else{const u=o.pbrMetallicRoughness||{};if(l.color=new Color(1,1,1),l.opacity=1,Array.isArray(u.baseColorFactor)){const d=u.baseColorFactor;l.color.setRGB(d[0],d[1],d[2],LinearSRGBColorSpace),l.opacity=d[3]}u.baseColorTexture!==void 0&&c.push(t.assignTexture(l,"map",u.baseColorTexture,SRGBColorSpace)),l.metalness=u.metallicFactor!==void 0?u.metallicFactor:1,l.roughness=u.roughnessFactor!==void 0?u.roughnessFactor:1,u.metallicRoughnessTexture!==void 0&&(c.push(t.assignTexture(l,"metalnessMap",u.metallicRoughnessTexture)),c.push(t.assignTexture(l,"roughnessMap",u.metallicRoughnessTexture))),i=this._invokeOne(function(d){return d.getMaterialType&&d.getMaterialType(e)}),c.push(Promise.all(this._invokeAll(function(d){return d.extendMaterialParams&&d.extendMaterialParams(e,l)})))}o.doubleSided===!0&&(l.side=DoubleSide);const h=o.alphaMode||ALPHA_MODES.OPAQUE;if(h===ALPHA_MODES.BLEND?(l.transparent=!0,l.depthWrite=!1):(l.transparent=!1,h===ALPHA_MODES.MASK&&(l.alphaTest=o.alphaCutoff!==void 0?o.alphaCutoff:.5)),o.normalTexture!==void 0&&i!==MeshBasicMaterial&&(c.push(t.assignTexture(l,"normalMap",o.normalTexture)),l.normalScale=new Vector2(1,1),o.normalTexture.scale!==void 0)){const u=o.normalTexture.scale;l.normalScale.set(u,u)}if(o.occlusionTexture!==void 0&&i!==MeshBasicMaterial&&(c.push(t.assignTexture(l,"aoMap",o.occlusionTexture)),o.occlusionTexture.strength!==void 0&&(l.aoMapIntensity=o.occlusionTexture.strength)),o.emissiveFactor!==void 0&&i!==MeshBasicMaterial){const u=o.emissiveFactor;l.emissive=new Color().setRGB(u[0],u[1],u[2],LinearSRGBColorSpace)}return o.emissiveTexture!==void 0&&i!==MeshBasicMaterial&&c.push(t.assignTexture(l,"emissiveMap",o.emissiveTexture,SRGBColorSpace)),Promise.all(c).then(function(){const u=new i(l);return o.name&&(u.name=o.name),assignExtrasToUserData(u,o),t.associations.set(u,{materials:e}),o.extensions&&addUnknownExtensionsToUserData(n,u,o),u})}createUniqueName(e){const t=PropertyBinding.sanitizeNodeName(e||"");return t in this.nodeNamesUsed?t+"_"+ ++this.nodeNamesUsed[t]:(this.nodeNamesUsed[t]=0,t)}loadGeometries(e){const t=this,s=this.extensions,n=this.primitiveCache;function o(l){return s[EXTENSIONS.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(l,t).then(function(r){return addPrimitiveAttributes(r,l,t)})}const i=[];for(let l=0,r=e.length;l<r;l++){const c=e[l],h=createPrimitiveKey(c),u=n[h];if(u)i.push(u.promise);else{let d;c.extensions&&c.extensions[EXTENSIONS.KHR_DRACO_MESH_COMPRESSION]?d=o(c):d=addPrimitiveAttributes(new BufferGeometry,c,t),n[h]={primitive:c,promise:d},i.push(d)}}return Promise.all(i)}loadMesh(e){const t=this,s=this.json,n=this.extensions,o=s.meshes[e],i=o.primitives,l=[];for(let r=0,c=i.length;r<c;r++){const h=i[r].material===void 0?createDefaultMaterial(this.cache):this.getDependency("material",i[r].material);l.push(h)}return l.push(t.loadGeometries(i)),Promise.all(l).then(function(r){const c=r.slice(0,r.length-1),h=r[r.length-1],u=[];for(let p=0,f=h.length;p<f;p++){const _=h[p],m=i[p];let g;const T=c[p];if(m.mode===WEBGL_CONSTANTS.TRIANGLES||m.mode===WEBGL_CONSTANTS.TRIANGLE_STRIP||m.mode===WEBGL_CONSTANTS.TRIANGLE_FAN||m.mode===void 0)g=o.isSkinnedMesh===!0?new SkinnedMesh(_,T):new Mesh(_,T),g.isSkinnedMesh===!0&&g.normalizeSkinWeights(),m.mode===WEBGL_CONSTANTS.TRIANGLE_STRIP?g.geometry=toTrianglesDrawMode(g.geometry,TriangleStripDrawMode):m.mode===WEBGL_CONSTANTS.TRIANGLE_FAN&&(g.geometry=toTrianglesDrawMode(g.geometry,TriangleFanDrawMode));else if(m.mode===WEBGL_CONSTANTS.LINES)g=new LineSegments(_,T);else if(m.mode===WEBGL_CONSTANTS.LINE_STRIP)g=new Line(_,T);else if(m.mode===WEBGL_CONSTANTS.LINE_LOOP)g=new LineLoop(_,T);else if(m.mode===WEBGL_CONSTANTS.POINTS)g=new Points(_,T);else throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+m.mode);Object.keys(g.geometry.morphAttributes).length>0&&updateMorphTargets(g,o),g.name=t.createUniqueName(o.name||"mesh_"+e),assignExtrasToUserData(g,o),m.extensions&&addUnknownExtensionsToUserData(n,g,m),t.assignFinalMaterial(g),u.push(g)}for(let p=0,f=u.length;p<f;p++)t.associations.set(u[p],{meshes:e,primitives:p});if(u.length===1)return o.extensions&&addUnknownExtensionsToUserData(n,u[0],o),u[0];const d=new Group;o.extensions&&addUnknownExtensionsToUserData(n,d,o),t.associations.set(d,{meshes:e});for(let p=0,f=u.length;p<f;p++)d.add(u[p]);return d})}loadCamera(e){let t;const s=this.json.cameras[e],n=s[s.type];if(!n){console.warn("THREE.GLTFLoader: Missing camera parameters.");return}return s.type==="perspective"?t=new PerspectiveCamera(MathUtils.radToDeg(n.yfov),n.aspectRatio||1,n.znear||1,n.zfar||2e6):s.type==="orthographic"&&(t=new OrthographicCamera(-n.xmag,n.xmag,n.ymag,-n.ymag,n.znear,n.zfar)),s.name&&(t.name=this.createUniqueName(s.name)),assignExtrasToUserData(t,s),Promise.resolve(t)}loadSkin(e){const t=this.json.skins[e],s=[];for(let n=0,o=t.joints.length;n<o;n++)s.push(this._loadNodeShallow(t.joints[n]));return t.inverseBindMatrices!==void 0?s.push(this.getDependency("accessor",t.inverseBindMatrices)):s.push(null),Promise.all(s).then(function(n){const o=n.pop(),i=n,l=[],r=[];for(let c=0,h=i.length;c<h;c++){const u=i[c];if(u){l.push(u);const d=new Matrix4;o!==null&&d.fromArray(o.array,c*16),r.push(d)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',t.joints[c])}return new Skeleton(l,r)})}loadAnimation(e){const t=this.json,s=this,n=t.animations[e],o=n.name?n.name:"animation_"+e,i=[],l=[],r=[],c=[],h=[];for(let u=0,d=n.channels.length;u<d;u++){const p=n.channels[u],f=n.samplers[p.sampler],_=p.target,m=_.node,g=n.parameters!==void 0?n.parameters[f.input]:f.input,T=n.parameters!==void 0?n.parameters[f.output]:f.output;_.node!==void 0&&(i.push(this.getDependency("node",m)),l.push(this.getDependency("accessor",g)),r.push(this.getDependency("accessor",T)),c.push(f),h.push(_))}return Promise.all([Promise.all(i),Promise.all(l),Promise.all(r),Promise.all(c),Promise.all(h)]).then(function(u){const d=u[0],p=u[1],f=u[2],_=u[3],m=u[4],g=[];for(let T=0,S=d.length;T<S;T++){const y=d[T],b=p[T],A=f[T],E=_[T],w=m[T];if(y===void 0)continue;y.updateMatrix&&y.updateMatrix();const x=s._createAnimationTracks(y,b,A,E,w);if(x)for(let M=0;M<x.length;M++)g.push(x[M])}return new AnimationClip(o,void 0,g)})}createNodeMesh(e){const t=this.json,s=this,n=t.nodes[e];return n.mesh===void 0?null:s.getDependency("mesh",n.mesh).then(function(o){const i=s._getNodeRef(s.meshCache,n.mesh,o);return n.weights!==void 0&&i.traverse(function(l){if(l.isMesh)for(let r=0,c=n.weights.length;r<c;r++)l.morphTargetInfluences[r]=n.weights[r]}),i})}loadNode(e){const t=this.json,s=this,n=t.nodes[e],o=s._loadNodeShallow(e),i=[],l=n.children||[];for(let c=0,h=l.length;c<h;c++)i.push(s.getDependency("node",l[c]));const r=n.skin===void 0?Promise.resolve(null):s.getDependency("skin",n.skin);return Promise.all([o,Promise.all(i),r]).then(function(c){const h=c[0],u=c[1],d=c[2];d!==null&&h.traverse(function(p){p.isSkinnedMesh&&p.bind(d,_identityMatrix)});for(let p=0,f=u.length;p<f;p++)h.add(u[p]);return h})}_loadNodeShallow(e){const t=this.json,s=this.extensions,n=this;if(this.nodeCache[e]!==void 0)return this.nodeCache[e];const o=t.nodes[e],i=o.name?n.createUniqueName(o.name):"",l=[],r=n._invokeOne(function(c){return c.createNodeMesh&&c.createNodeMesh(e)});return r&&l.push(r),o.camera!==void 0&&l.push(n.getDependency("camera",o.camera).then(function(c){return n._getNodeRef(n.cameraCache,o.camera,c)})),n._invokeAll(function(c){return c.createNodeAttachment&&c.createNodeAttachment(e)}).forEach(function(c){l.push(c)}),this.nodeCache[e]=Promise.all(l).then(function(c){let h;if(o.isBone===!0?h=new Bone:c.length>1?h=new Group:c.length===1?h=c[0]:h=new Object3D,h!==c[0])for(let u=0,d=c.length;u<d;u++)h.add(c[u]);if(o.name&&(h.userData.name=o.name,h.name=i),assignExtrasToUserData(h,o),o.extensions&&addUnknownExtensionsToUserData(s,h,o),o.matrix!==void 0){const u=new Matrix4;u.fromArray(o.matrix),h.applyMatrix4(u)}else o.translation!==void 0&&h.position.fromArray(o.translation),o.rotation!==void 0&&h.quaternion.fromArray(o.rotation),o.scale!==void 0&&h.scale.fromArray(o.scale);return n.associations.has(h)||n.associations.set(h,{}),n.associations.get(h).nodes=e,h}),this.nodeCache[e]}loadScene(e){const t=this.extensions,s=this.json.scenes[e],n=this,o=new Group;s.name&&(o.name=n.createUniqueName(s.name)),assignExtrasToUserData(o,s),s.extensions&&addUnknownExtensionsToUserData(t,o,s);const i=s.nodes||[],l=[];for(let r=0,c=i.length;r<c;r++)l.push(n.getDependency("node",i[r]));return Promise.all(l).then(function(r){for(let h=0,u=r.length;h<u;h++)o.add(r[h]);const c=h=>{const u=new Map;for(const[d,p]of n.associations)(d instanceof Material||d instanceof Texture)&&u.set(d,p);return h.traverse(d=>{const p=n.associations.get(d);p!=null&&u.set(d,p)}),u};return n.associations=c(o),o})}_createAnimationTracks(e,t,s,n,o){const i=[],l=e.name?e.name:e.uuid,r=[];PATH_PROPERTIES[o.path]===PATH_PROPERTIES.weights?e.traverse(function(d){d.morphTargetInfluences&&r.push(d.name?d.name:d.uuid)}):r.push(l);let c;switch(PATH_PROPERTIES[o.path]){case PATH_PROPERTIES.weights:c=NumberKeyframeTrack;break;case PATH_PROPERTIES.rotation:c=QuaternionKeyframeTrack;break;case PATH_PROPERTIES.position:case PATH_PROPERTIES.scale:c=VectorKeyframeTrack;break;default:switch(s.itemSize){case 1:c=NumberKeyframeTrack;break;case 2:case 3:default:c=VectorKeyframeTrack;break}break}const h=n.interpolation!==void 0?INTERPOLATION[n.interpolation]:InterpolateLinear,u=this._getArrayFromAccessor(s);for(let d=0,p=r.length;d<p;d++){const f=new c(r[d]+"."+PATH_PROPERTIES[o.path],t.array,u,h);n.interpolation==="CUBICSPLINE"&&this._createCubicSplineTrackInterpolant(f),i.push(f)}return i}_getArrayFromAccessor(e){let t=e.array;if(e.normalized){const s=getNormalizedComponentScale(t.constructor),n=new Float32Array(t.length);for(let o=0,i=t.length;o<i;o++)n[o]=t[o]*s;t=n}return t}_createCubicSplineTrackInterpolant(e){e.createInterpolant=function(s){const n=this instanceof QuaternionKeyframeTrack?GLTFCubicSplineQuaternionInterpolant:GLTFCubicSplineInterpolant;return new n(this.times,this.values,this.getValueSize()/3,s)},e.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0}}function computeBounds(a,e,t){const s=e.attributes,n=new Box3;if(s.POSITION!==void 0){const l=t.json.accessors[s.POSITION],r=l.min,c=l.max;if(r!==void 0&&c!==void 0){if(n.set(new Vector3(r[0],r[1],r[2]),new Vector3(c[0],c[1],c[2])),l.normalized){const h=getNormalizedComponentScale(WEBGL_COMPONENT_TYPES[l.componentType]);n.min.multiplyScalar(h),n.max.multiplyScalar(h)}}else{console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");return}}else return;const o=e.targets;if(o!==void 0){const l=new Vector3,r=new Vector3;for(let c=0,h=o.length;c<h;c++){const u=o[c];if(u.POSITION!==void 0){const d=t.json.accessors[u.POSITION],p=d.min,f=d.max;if(p!==void 0&&f!==void 0){if(r.setX(Math.max(Math.abs(p[0]),Math.abs(f[0]))),r.setY(Math.max(Math.abs(p[1]),Math.abs(f[1]))),r.setZ(Math.max(Math.abs(p[2]),Math.abs(f[2]))),d.normalized){const _=getNormalizedComponentScale(WEBGL_COMPONENT_TYPES[d.componentType]);r.multiplyScalar(_)}l.max(r)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}n.expandByVector(l)}a.boundingBox=n;const i=new Sphere;n.getCenter(i.center),i.radius=n.min.distanceTo(n.max)/2,a.boundingSphere=i}function addPrimitiveAttributes(a,e,t){const s=e.attributes,n=[];function o(i,l){return t.getDependency("accessor",i).then(function(r){a.setAttribute(l,r)})}for(const i in s){const l=ATTRIBUTES[i]||i.toLowerCase();l in a.attributes||n.push(o(s[i],l))}if(e.indices!==void 0&&!a.index){const i=t.getDependency("accessor",e.indices).then(function(l){a.setIndex(l)});n.push(i)}return ColorManagement.workingColorSpace!==LinearSRGBColorSpace&&"COLOR_0"in s&&console.warn(`THREE.GLTFLoader: Converting vertex colors from "srgb-linear" to "${ColorManagement.workingColorSpace}" not supported.`),assignExtrasToUserData(a,e),computeBounds(a,e,t),Promise.all(n).then(function(){return e.targets!==void 0?addMorphTargets(a,e.targets,t):a})}var vertex_default$1=`uniform float uTime;
uniform sampler2D uPerlinTexture;

varying vec2 vUv;

vec2 rotate2D(vec2 value, float angle)
{
    float s = sin(angle);
    float c = cos(angle);
    mat2 m = mat2(c, s, -s, c);
    return m * value;
}

void main()
{
    vec3 newPosition = position;

    
    float twistPerlin = texture(
        uPerlinTexture,
        vec2(0.5, uv.y * 0.2 - uTime * 0.01)
    ).r;
    float angle = twistPerlin * 3.0;
    newPosition.xz = rotate2D(newPosition.xz, angle);

    
    vec2 windOffset = vec2(
        texture(uPerlinTexture, vec2(0.25, uTime * 0.01)).r - 0.5,
        texture(uPerlinTexture, vec2(0.75, uTime * 0.01)).r - 0.5
    );
    windOffset *= pow(uv.y, 2.0) * 1.5;
    newPosition.xz += windOffset;

    
    gl_Position = projectionMatrix * modelViewMatrix * vec4(newPosition, 1.0);

    
    vUv = uv;
}`,fragment_default$1=`uniform float uTime;
uniform sampler2D uPerlinTexture;

varying vec2 vUv;

void main()
{
    
    vec2 smokeUv = vUv;
    smokeUv.x *= 0.5;
    smokeUv.y *= 0.3;
    smokeUv.y -= uTime * 0.04;

    
    float smoke = texture(uPerlinTexture, smokeUv).r;

    
    smoke = smoothstep(0.4, 1.0, smoke);

    
    smoke *= smoothstep(0.0, 0.1, vUv.x);
    smoke *= smoothstep(1.0, 0.9, vUv.x);
    smoke *= smoothstep(0.0, 0.1, vUv.y);
    smoke *= smoothstep(1.0, 0.4, vUv.y);

    
    gl_FragColor = vec4(1, 1, 1, smoke);
    #include <tonemapping_fragment>
    #include <colorspace_fragment>
}`,vertex_default=`varying vec2 vUv;

void main()
{
    vec4 modelPosition = modelMatrix * vec4(position, 1.0);
    vec4 viewPosition = viewMatrix * modelPosition;
    vec4 projectionPosition = projectionMatrix * viewPosition;
    gl_Position = projectionPosition;

    vUv = uv;
}`,fragment_default=`uniform sampler2D uDayTexture1;
uniform sampler2D uNightTexture1;
uniform sampler2D uDayTexture2;
uniform sampler2D uNightTexture2;
uniform sampler2D uDayTexture3;
uniform sampler2D uNightTexture3;
uniform sampler2D uDayTexture4;
uniform sampler2D uNightTexture4;
uniform float uMixRatio;
uniform int uTextureSet;

varying vec2 vUv;

void main() {
    vec3 dayColor;
    vec3 nightColor;
    
    if(uTextureSet == 1) {
        dayColor = texture2D(uDayTexture1, vUv).rgb;
        nightColor = texture2D(uNightTexture1, vUv).rgb;
    } else if(uTextureSet == 2) {
        dayColor = texture2D(uDayTexture2, vUv).rgb;
        nightColor = texture2D(uNightTexture2, vUv).rgb;
    } else if(uTextureSet == 3) {
        dayColor = texture2D(uDayTexture3, vUv).rgb;
        nightColor = texture2D(uNightTexture3, vUv).rgb;
    } else {
        dayColor = texture2D(uDayTexture4, vUv).rgb;
        nightColor = texture2D(uNightTexture4, vUv).rgb;
    }
    
    vec3 finalColor = mix(dayColor, nightColor, uMixRatio);
    finalColor = pow(finalColor, vec3(1.0/2.2));
    gl_FragColor = vec4(finalColor, 1.0);
}`;let pianoDebounceTimer=null,isMusicFaded=!1;const MUSIC_FADE_TIME=500,PIANO_TIMEOUT=2e3,BACKGROUND_MUSIC_VOLUME=1,FADED_VOLUME=0,backgroundMusic=new howlerExports.Howl({src:["/audio/music/cosmic_candy.ogg"],loop:!0,volume:1}),fadeOutBackgroundMusic=()=>{!isMuted&&!isMusicFaded&&(backgroundMusic.fade(backgroundMusic.volume(),FADED_VOLUME,MUSIC_FADE_TIME),isMusicFaded=!0)},fadeInBackgroundMusic=()=>{!isMuted&&isMusicFaded&&(backgroundMusic.fade(FADED_VOLUME,BACKGROUND_MUSIC_VOLUME,MUSIC_FADE_TIME),isMusicFaded=!1)},pianoKeyMap={C1_Key:"Key_24","C#1_Key":"Key_23",D1_Key:"Key_22","D#1_Key":"Key_21",E1_Key:"Key_20",F1_Key:"Key_19","F#1_Key":"Key_18",G1_Key:"Key_17","G#1_Key":"Key_16",A1_Key:"Key_15","A#1_Key":"Key_14",B1_Key:"Key_13",C2_Key:"Key_12","C#2_Key":"Key_11",D2_Key:"Key_10","D#2_Key":"Key_9",E2_Key:"Key_8",F2_Key:"Key_7","F#2_Key":"Key_6",G2_Key:"Key_5","G#2_Key":"Key_4",A2_Key:"Key_3","A#2_Key":"Key_2",B2_Key:"Key_1"},pianoSounds={};Object.values(pianoKeyMap).forEach(a=>{pianoSounds[a]=new howlerExports.Howl({src:[`/audio/sfx/piano/${a}.ogg`],preload:!0,volume:.5})});const buttonSounds={click:new howlerExports.Howl({src:["/audio/sfx/click/bubble.ogg"],preload:!0,volume:.5})},canvas=document.querySelector("#experience-canvas"),sizes={width:window.innerWidth,height:window.innerHeight},scene=new Scene;scene.background=new Color("#D9CAD1");const camera=new PerspectiveCamera(35,sizes.width/sizes.height,.1,200),renderer=new WebGLRenderer({canvas,antialias:!0});renderer.setSize(sizes.width,sizes.height);renderer.setPixelRatio(Math.min(window.devicePixelRatio,2));const controls=new OrbitControls(camera,renderer.domElement);controls.minDistance=5;controls.maxDistance=45;controls.minPolarAngle=0;controls.maxPolarAngle=Math.PI/2;controls.minAzimuthAngle=0;controls.maxAzimuthAngle=Math.PI/2;controls.enableDamping=!0;controls.dampingFactor=.05;controls.update();window.innerWidth<768?(camera.position.set(29.567116827654726,14.018476147584705,31.37040363900147),controls.target.set(-.08206262548844094,3.3119233527087255,-.7433922282864018)):(camera.position.set(17.49173098423395,9.108969527553887,17.850992894238058),controls.target.set(.4624746759408973,1.9719940043010387,-.8300979125494505));window.addEventListener("resize",()=>{sizes.width=window.innerWidth,sizes.height=window.innerHeight,camera.aspect=sizes.width/sizes.height,camera.updateProjectionMatrix(),renderer.setSize(sizes.width,sizes.height),renderer.setPixelRatio(Math.min(window.devicePixelRatio,2))});const modals={work:document.querySelector(".modal.work"),about:document.querySelector(".modal.about"),contact:document.querySelector(".modal.contact")},overlay=document.querySelector(".overlay");let touchHappened=!1;overlay.addEventListener("touchend",a=>{touchHappened=!0,a.preventDefault();const e=document.querySelector('.modal[style*="display: block"]');e&&hideModal(e)},{passive:!1});overlay.addEventListener("click",a=>{if(touchHappened)return;a.preventDefault();const e=document.querySelector('.modal[style*="display: block"]');e&&hideModal(e)},{passive:!1});document.querySelectorAll(".modal-exit-button").forEach(a=>{function e(t){t.preventDefault();const s=t.target.closest(".modal");gsapWithCSS.to(a,{scale:5,duration:.5,ease:"back.out(2)",onStart:()=>{gsapWithCSS.to(a,{scale:1,duration:.5,ease:"back.out(2)",onComplete:()=>{gsapWithCSS.set(a,{clearProps:"all"})}})}}),buttonSounds.click.play(),hideModal(s)}a.addEventListener("touchend",t=>{touchHappened=!0,e(t)},{passive:!1}),a.addEventListener("click",t=>{touchHappened||e(t)},{passive:!1})});let isModalOpen=!0;const showModal=a=>{a.style.display="block",overlay.style.display="block",isModalOpen=!0,controls.enabled=!1,currentHoveredObject&&(playHoverAnimation(currentHoveredObject,!1),currentHoveredObject=null),document.body.style.cursor="default",currentIntersects=[],gsapWithCSS.set(a,{opacity:0,scale:0}),gsapWithCSS.set(overlay,{opacity:0}),gsapWithCSS.to(overlay,{opacity:1,duration:.5}),gsapWithCSS.to(a,{opacity:1,scale:1,duration:.5,ease:"back.out(2)"})},hideModal=a=>{isModalOpen=!1,controls.enabled=!0,gsapWithCSS.to(overlay,{opacity:0,duration:.5}),gsapWithCSS.to(a,{opacity:0,scale:0,duration:.5,ease:"back.in(2)",onComplete:()=>{a.style.display="none",overlay.style.display="none"}})},manager=new LoadingManager,loadingScreen=document.querySelector(".loading-screen"),loadingScreenButton=document.querySelector(".loading-screen-button");document.querySelector(".desktop-instructions");document.querySelector(".mobile-instructions");manager.onLoad=function(){loadingScreenButton.style.border="8px solid #2a0f4e",loadingScreenButton.style.background="#401d49",loadingScreenButton.style.color="#e6dede",loadingScreenButton.style.boxShadow="rgba(0, 0, 0, 0.24) 0px 3px 8px",loadingScreenButton.textContent="Enter!",loadingScreenButton.style.cursor="pointer",loadingScreenButton.style.transition="transform 0.4s cubic-bezier(0.34, 1.56, 0.64, 1)";let a=!1;function e(){a||(loadingScreenButton.style.cursor="default",loadingScreenButton.style.border="8px solid #6e5e9c",loadingScreenButton.style.background="#ead7ef",loadingScreenButton.style.color="#6e5e9c",loadingScreenButton.style.boxShadow="none",loadingScreenButton.textContent="~ ezzizz ~",loadingScreen.style.background="#ead7ef",a=!0,toggleFavicons(),backgroundMusic.play(),playReveal())}loadingScreenButton.addEventListener("mouseenter",()=>{loadingScreenButton.style.transform="scale(1.3)"}),loadingScreenButton.addEventListener("touchend",t=>{touchHappened=!0,t.preventDefault(),e()}),loadingScreenButton.addEventListener("click",t=>{touchHappened||e()}),loadingScreenButton.addEventListener("mouseleave",()=>{loadingScreenButton.style.transform="none"})};function playReveal(){gsapWithCSS.timeline().to(loadingScreen,{scale:.5,duration:1.2,delay:.25,ease:"back.in(1.8)"}).to(loadingScreen,{y:"200vh",transform:"perspective(1000px) rotateX(45deg) rotateY(-35deg)",duration:1.2,ease:"back.in(1.8)",onComplete:()=>{isModalOpen=!1,playIntroAnimation(),loadingScreen.remove()}},"-=0.1")}function playIntroAnimation(){const a=gsapWithCSS.timeline({defaults:{duration:.8,ease:"back.out(1.8)"}});a.timeScale(.8),a.to(plank1.scale,{x:1,y:1}).to(plank2.scale,{x:1,y:1,z:1},"-=0.5").to(workBtn.scale,{x:1,y:1,z:1},"-=0.6").to(aboutBtn.scale,{x:1,y:1,z:1},"-=0.6").to(contactBtn.scale,{x:1,y:1,z:1},"-=0.6");const e=gsapWithCSS.timeline({defaults:{duration:.8,ease:"back.out(1.8)"}});e.timeScale(.8),e.to(frame1.scale,{x:1,y:1,z:1}).to(frame2.scale,{x:1,y:1,z:1},"-=0.5").to(frame3.scale,{x:1,y:1,z:1},"-=0.5");const t=gsapWithCSS.timeline({defaults:{duration:.8,ease:"back.out(1.8)"}});t.timeScale(.8),t.to(boba.scale,{z:1,y:1,x:1,delay:.4}).to(github.scale,{x:1,y:1,z:1},"-=0.5").to(youtube.scale,{x:1,y:1,z:1},"-=0.6").to(twitter.scale,{x:1,y:1,z:1},"-=0.6");const s=gsapWithCSS.timeline({defaults:{duration:.8,ease:"back.out(1.8)"}});s.timeScale(.8),s.to(flower5.scale,{x:1,y:1,z:1}).to(flower4.scale,{x:1,y:1,z:1},"-=0.5").to(flower3.scale,{x:1,y:1,z:1},"-=0.5").to(flower2.scale,{x:1,y:1,z:1},"-=0.5").to(flower1.scale,{x:1,y:1,z:1},"-=0.5");const n=gsapWithCSS.timeline({defaults:{duration:.8,ease:"back.out(1.8)"}});n.timeScale(.8),n.to(box1.scale,{x:1,y:1,z:1}).to(box2.scale,{x:1,y:1,z:1},"-=0.5").to(box3.scale,{x:1,y:1,z:1},"-=0.5");const o=gsapWithCSS.timeline({defaults:{duration:.8,delay:.2,ease:"back.out(1.8)"}});o.timeScale(.8),o.to(lamp.scale,{x:1,y:1,z:1});const i=gsapWithCSS.timeline({defaults:{duration:.8,ease:"back.out(1.8)"}});i.timeScale(.8),i.to(slippers1.scale,{x:1,y:1,z:1,delay:.5}).to(slippers2.scale,{x:1,y:1,z:1},"-=0.5");const l=gsapWithCSS.timeline({defaults:{duration:.8,ease:"back.out(1.8)"}});l.timeScale(.8),l.to(egg1.scale,{x:1,y:1,z:1}).to(egg2.scale,{x:1,y:1,z:1},"-=0.5").to(egg3.scale,{x:1,y:1,z:1},"-=0.5");const r=gsapWithCSS.timeline({defaults:{delay:.8,duration:.8,ease:"back.out(1.8)"}});r.timeScale(.8),r.to(fish.scale,{x:1,y:1,z:1});const c=gsapWithCSS.timeline({defaults:{duration:.8,ease:"back.out(1.7)"}});c.timeScale(.8),c.to(letter1.position,{y:letter1.userData.initialPosition.y+.3,duration:.4,ease:"back.out(1.8)",delay:.25}).to(letter1.scale,{x:1,y:1,z:1,duration:.4,ease:"back.out(1.8)"},"<").to(letter1.position,{y:letter1.userData.initialPosition.y,duration:.4,ease:"back.out(1.8)"},">-0.2").to(letter2.position,{y:letter2.userData.initialPosition.y+.3,duration:.4,ease:"back.out(1.8)"},"-=0.5").to(letter2.scale,{x:1,y:1,z:1,duration:.4,ease:"back.out(1.8)"},"<").to(letter2.position,{y:letter2.userData.initialPosition.y,duration:.4,ease:"back.out(1.8)"},">-0.2").to(letter3.position,{y:letter3.userData.initialPosition.y+.3,duration:.4,ease:"back.out(1.8)"},"-=0.5").to(letter3.scale,{x:1,y:1,z:1,duration:.4,ease:"back.out(1.8)"},"<").to(letter3.position,{y:letter3.userData.initialPosition.y,duration:.4,ease:"back.out(1.8)"},">-0.2").to(letter4.position,{y:letter4.userData.initialPosition.y+.3,duration:.4,ease:"back.out(1.8)"},"-=0.5").to(letter4.scale,{x:1,y:1,z:1,duration:.4,ease:"back.out(1.8)"},"<").to(letter4.position,{y:letter4.userData.initialPosition.y,duration:.4,ease:"back.out(1.8)"},">-0.2").to(letter5.position,{y:letter5.userData.initialPosition.y+.3,duration:.4,ease:"back.out(1.8)"},"-=0.5").to(letter5.scale,{x:1,y:1,z:1,duration:.4,ease:"back.out(1.8)"},"<").to(letter5.position,{y:letter5.userData.initialPosition.y,duration:.4,ease:"back.out(1.8)"},">-0.2").to(letter6.position,{y:letter6.userData.initialPosition.y+.3,duration:.4,ease:"back.out(1.8)"},"-=0.5").to(letter6.scale,{x:1,y:1,z:1,duration:.4,ease:"back.out(1.8)"},"<").to(letter6.position,{y:letter6.userData.initialPosition.y,duration:.4,ease:"back.out(1.8)"},">-0.2").to(letter7.position,{y:letter7.userData.initialPosition.y+.3,duration:.4,ease:"back.out(1.8)"},"-=0.5").to(letter7.scale,{x:1,y:1,z:1,duration:.4,ease:"back.out(1.8)"},"<").to(letter7.position,{y:letter7.userData.initialPosition.y,duration:.4,ease:"back.out(1.8)"},">-0.2").to(letter8.position,{y:letter8.userData.initialPosition.y+.3,duration:.4,ease:"back.out(1.8)"},"-=0.5").to(letter8.scale,{x:1,y:1,z:1,duration:.4,ease:"back.out(1.8)"},"<").to(letter8.position,{y:letter8.userData.initialPosition.y,duration:.4,ease:"back.out(1.8)"},">-0.2");const h=gsapWithCSS.timeline({defaults:{duration:.4,ease:"back.out(1.7)"}});h.timeScale(1.2),[C1_Key,Cs1_Key,D1_Key,Ds1_Key,E1_Key,F1_Key,Fs1_Key,G1_Key,Gs1_Key,A1_Key,As1_Key,B1_Key,C2_Key,Cs2_Key,D2_Key,Ds2_Key,E2_Key,F2_Key,Fs2_Key,G2_Key,Gs2_Key,A2_Key,As2_Key,B2_Key].forEach((d,p)=>{h.to(d.position,{y:d.userData.initialPosition.y+.2,duration:.4,ease:"back.out(1.8)"},p*.1).to(d.scale,{x:1,y:1,z:1,duration:.4,ease:"back.out(1.8)"},"<").to(d.position,{y:d.userData.initialPosition.y,duration:.4,ease:"back.out(1.8)"},">-0.2")})}const textureLoader=new TextureLoader,dracoLoader=new DRACOLoader;dracoLoader.setDecoderPath("/draco/");const loader=new GLTFLoader(manager);loader.setDRACOLoader(dracoLoader);const environmentMap=new CubeTextureLoader().setPath("textures/skybox/").load(["px.webp","nx.webp","py.webp","ny.webp","pz.webp","nz.webp"]),textureMap={First:{day:"/textures/room/day/first_texture_set_day.webp",night:"/textures/room/night/first_texture_set_night.webp"},Second:{day:"/textures/room/day/second_texture_set_day.webp",night:"/textures/room/night/second_texture_set_night.webp"},Third:{day:"/textures/room/day/third_texture_set_day.webp",night:"/textures/room/night/third_texture_set_night.webp"},Fourth:{day:"/textures/room/day/fourth_texture_set_day.webp",night:"/textures/room/night/fourth_texture_set_night.webp"}},loadedTextures={day:{},night:{}};Object.entries(textureMap).forEach(([a,e])=>{const t=textureLoader.load(e.day);t.flipY=!1,t.colorSpace=SRGBColorSpace,t.minFilter=LinearFilter,t.magFilter=LinearFilter,loadedTextures.day[a]=t;const s=textureLoader.load(e.night);s.flipY=!1,s.colorSpace=SRGBColorSpace,s.minFilter=LinearFilter,s.magFilter=LinearFilter,loadedTextures.night[a]=s});const glassMaterial=new MeshPhysicalMaterial({transmission:1,opacity:1,color:16514043,metalness:0,roughness:0,ior:3,thickness:.01,specularIntensity:1,envMap:environmentMap,envMapIntensity:1,depthWrite:!1,specularColor:16514043}),whiteMaterial=new MeshBasicMaterial({color:16777215}),createMaterialForTextureSet=a=>{const e=new ShaderMaterial({uniforms:{uDayTexture1:{value:loadedTextures.day.First},uNightTexture1:{value:loadedTextures.night.First},uDayTexture2:{value:loadedTextures.day.Second},uNightTexture2:{value:loadedTextures.night.Second},uDayTexture3:{value:loadedTextures.day.Third},uNightTexture3:{value:loadedTextures.night.Third},uDayTexture4:{value:loadedTextures.day.Fourth},uNightTexture4:{value:loadedTextures.night.Fourth},uMixRatio:{value:0},uTextureSet:{value:a}},vertexShader:vertex_default,fragmentShader:fragment_default});return Object.entries(e.uniforms).forEach(([t,s])=>{s.value instanceof Texture&&(s.value.minFilter=LinearFilter,s.value.magFilter=LinearFilter)}),e},roomMaterials={First:createMaterialForTextureSet(1),Second:createMaterialForTextureSet(2),Third:createMaterialForTextureSet(3),Fourth:createMaterialForTextureSet(4)},smokeGeometry=new PlaneGeometry(1,1,16,64);smokeGeometry.translate(0,.5,0);smokeGeometry.scale(.33,1,.33);const perlinTexture=textureLoader.load("/shaders/perlin.png");perlinTexture.wrapS=RepeatWrapping;perlinTexture.wrapT=RepeatWrapping;const smokeMaterial=new ShaderMaterial({vertexShader:vertex_default$1,fragmentShader:fragment_default$1,uniforms:{uTime:new Uniform(0),uPerlinTexture:new Uniform(perlinTexture)},side:DoubleSide,transparent:!0,depthWrite:!1}),smoke=new Mesh(smokeGeometry,smokeMaterial);smoke.position.y=1.83;scene.add(smoke);const videoElement=document.createElement("video");videoElement.src="/textures/video/Screen.mp4";videoElement.loop=!0;videoElement.muted=!0;videoElement.playsInline=!0;videoElement.autoplay=!0;videoElement.play();const videoTexture=new VideoTexture(videoElement);videoTexture.colorSpace=SRGBColorSpace;videoTexture.flipY=!1;let fish,coffeePosition,hourHand,minuteHand,chairTop;const xAxisFans=[],yAxisFans=[];let plank1,plank2,workBtn,aboutBtn,contactBtn,boba,github,youtube,twitter,letter1,letter2,letter3,letter4,letter5,letter6,letter7,letter8,C1_Key,Cs1_Key,D1_Key,Ds1_Key,E1_Key,F1_Key,Fs1_Key,G1_Key,Gs1_Key,A1_Key,As1_Key,B1_Key,C2_Key,Cs2_Key,D2_Key,Ds2_Key,E2_Key,F2_Key,Fs2_Key,G2_Key,Gs2_Key,A2_Key,As2_Key,B2_Key,flower1,flower2,flower3,flower4,flower5,box1,box2,box3,lamp,slippers1,slippers2,egg1,egg2,egg3,frame1,frame2,frame3;loader.load("/models/Room_Portfolio.glb",glb=>{glb.scene.traverse(child=>{child.isMesh&&(child.name.includes("Fish_Fourth")&&(fish=child,child.position.x+=.04,child.position.z-=.03,child.userData.initialPosition=new Vector3().copy(child.position)),child.name.includes("Chair_Top")&&(chairTop=child,child.userData.initialRotation=new Euler().copy(child.rotation)),child.name.includes("Hour_Hand")&&(hourHand=child,child.userData.initialRotation=new Euler().copy(child.rotation)),child.name.includes("Minute_Hand")&&(minuteHand=child,child.userData.initialRotation=new Euler().copy(child.rotation)),child.name.includes("Coffee")&&(coffeePosition=child.position.clone()),child.name.includes("Raycaster")&&raycasterObjects.push(child),(child.name.includes("Hover")||child.name.includes("Key"))&&(child.userData.initialScale=new Vector3().copy(child.scale),child.userData.initialPosition=new Vector3().copy(child.position),child.userData.initialRotation=new Euler().copy(child.rotation)),child.name.includes("Hanging_Plank_1")?(plank1=child,child.scale.set(0,0,1)):child.name.includes("Hanging_Plank_2")?(plank2=child,child.scale.set(0,0,0)):child.name.includes("My_Work_Button")?(workBtn=child,child.scale.set(0,0,0)):child.name.includes("About_Button")?(aboutBtn=child,child.scale.set(0,0,0)):child.name.includes("Contact_Button")?(contactBtn=child,child.scale.set(0,0,0)):child.name.includes("Boba")?(boba=child,child.scale.set(0,0,0)):child.name.includes("GitHub")?(github=child,child.scale.set(0,0,0)):child.name.includes("YouTube")?(youtube=child,child.scale.set(0,0,0)):child.name.includes("Twitter")?(twitter=child,child.scale.set(0,0,0)):child.name.includes("Name_Letter_1")?(letter1=child,child.scale.set(0,0,0)):child.name.includes("Name_Letter_2")?(letter2=child,child.scale.set(0,0,0)):child.name.includes("Name_Letter_3")?(letter3=child,child.scale.set(0,0,0)):child.name.includes("Name_Letter_4")?(letter4=child,child.scale.set(0,0,0)):child.name.includes("Name_Letter_5")?(letter5=child,child.scale.set(0,0,0)):child.name.includes("Name_Letter_6")?(letter6=child,child.scale.set(0,0,0)):child.name.includes("Name_Letter_7")?(letter7=child,child.scale.set(0,0,0)):child.name.includes("Name_Letter_8")?(letter8=child,child.scale.set(0,0,0)):child.name.includes("Flower_1")?(flower1=child,child.scale.set(0,0,0)):child.name.includes("Flower_2")?(flower2=child,child.scale.set(0,0,0)):child.name.includes("Flower_3")?(flower3=child,child.scale.set(0,0,0)):child.name.includes("Flower_4")?(flower4=child,child.scale.set(0,0,0)):child.name.includes("Flower_5")?(flower5=child,child.scale.set(0,0,0)):child.name.includes("Box_1")?(box1=child,child.scale.set(0,0,0)):child.name.includes("Box_2")?(box2=child,child.scale.set(0,0,0)):child.name.includes("Box_3")?(box3=child,child.scale.set(0,0,0)):child.name.includes("Lamp")?(lamp=child,child.scale.set(0,0,0)):child.name.includes("Slipper_1")?(slippers1=child,child.scale.set(0,0,0)):child.name.includes("Slipper_2")?(slippers2=child,child.scale.set(0,0,0)):child.name.includes("Fish_Fourth")?child.scale.set(0,0,0):child.name.includes("Egg_1")?(egg1=child,child.scale.set(0,0,0)):child.name.includes("Egg_2")?(egg2=child,child.scale.set(0,0,0)):child.name.includes("Egg_3")?(egg3=child,child.scale.set(0,0,0)):child.name.includes("Frame_1")?(frame1=child,child.scale.set(0,0,0)):child.name.includes("Frame_2")?(frame2=child,child.scale.set(0,0,0)):child.name.includes("Frame_3")&&(frame3=child,child.scale.set(0,0,0)),Object.keys(pianoKeyMap).forEach(keyName=>{if(child.name.includes(keyName)){const varName=keyName.replace("#","s").split("_")[0]+"_Key";eval(`${varName} = child`),child.scale.set(0,0,0),child.userData.initialPosition=new Vector3().copy(child.position)}}),child.name.includes("Water")?child.material=new MeshBasicMaterial({color:5606344,transparent:!0,opacity:.4,depthWrite:!1}):child.name.includes("Glass")?child.material=glassMaterial:child.name.includes("Bubble")?child.material=whiteMaterial:child.name.includes("Screen")?child.material=new MeshBasicMaterial({map:videoTexture,transparent:!0,opacity:.9}):Object.keys(textureMap).forEach(a=>{child.name.includes(a)&&(child.material=roomMaterials[a],child.name.includes("Fan")&&(child.name.includes("Fan_2")||child.name.includes("Fan_4")?xAxisFans.push(child):yAxisFans.push(child)))}))}),coffeePosition&&smoke.position.set(coffeePosition.x,coffeePosition.y+.2,coffeePosition.z),scene.add(glb.scene)});const raycasterObjects=[];let currentIntersects=[],currentHoveredObject=null;const socialLinks={GitHub:"https://github.com/euii-ii",YouTube:"https://www.instagram.com/eiizz_zz/",Twitter:"https://www.linkedin.com/public-profile/settings?trk=d_flagship3_profile_self_view_public_profile"},raycaster=new Raycaster,pointer=new Vector2;function handleRaycasterInteraction(){if(currentIntersects.length>0){const a=currentIntersects[0].object;a.name.includes("Button")&&buttonSounds.click.play(),Object.entries(pianoKeyMap).forEach(([e,t])=>{a.name.includes(e)&&(pianoDebounceTimer&&clearTimeout(pianoDebounceTimer),fadeOutBackgroundMusic(),pianoSounds[t].play(),pianoDebounceTimer=setTimeout(()=>{fadeInBackgroundMusic()},PIANO_TIMEOUT),gsapWithCSS.to(a.rotation,{x:a.userData.initialRotation.x+Math.PI/42,duration:.4,ease:"back.out(2)",onComplete:()=>{gsapWithCSS.to(a.rotation,{x:a.userData.initialRotation.x,duration:.25,ease:"back.out(2)"})}}))}),Object.entries(socialLinks).forEach(([e,t])=>{if(a.name.includes(e)){const s=window.open();s.opener=null,s.location=t,s.target="_blank",s.rel="noopener noreferrer"}}),a.name.includes("Work_Button")?showModal(modals.work):a.name.includes("About_Button")?showModal(modals.about):a.name.includes("Contact_Button")&&showModal(modals.contact)}}function playHoverAnimation(a,e){let t=1.4;gsapWithCSS.killTweensOf(a.scale),gsapWithCSS.killTweensOf(a.rotation),gsapWithCSS.killTweensOf(a.position),a.name.includes("Coffee")&&(gsapWithCSS.killTweensOf(smoke.scale),e?gsapWithCSS.to(smoke.scale,{x:1.4,y:1.4,z:1.4,duration:.5,ease:"back.out(2)"}):gsapWithCSS.to(smoke.scale,{x:1,y:1,z:1,duration:.3,ease:"back.out(2)"})),a.name.includes("Fish")&&(t=1.2),e?(gsapWithCSS.to(a.scale,{x:a.userData.initialScale.x*t,y:a.userData.initialScale.y*t,z:a.userData.initialScale.z*t,duration:.5,ease:"back.out(2)"}),a.name.includes("About_Button")?gsapWithCSS.to(a.rotation,{x:a.userData.initialRotation.x-Math.PI/10,duration:.5,ease:"back.out(2)"}):(a.name.includes("Contact_Button")||a.name.includes("My_Work_Button")||a.name.includes("GitHub")||a.name.includes("YouTube")||a.name.includes("Twitter"))&&gsapWithCSS.to(a.rotation,{x:a.userData.initialRotation.x+Math.PI/10,duration:.5,ease:"back.out(2)"}),(a.name.includes("Boba")||a.name.includes("Name_Letter"))&&gsapWithCSS.to(a.position,{y:a.userData.initialPosition.y+.2,duration:.5,ease:"back.out(2)"})):(gsapWithCSS.to(a.scale,{x:a.userData.initialScale.x,y:a.userData.initialScale.y,z:a.userData.initialScale.z,duration:.3,ease:"back.out(2)"}),(a.name.includes("About_Button")||a.name.includes("Contact_Button")||a.name.includes("My_Work_Button")||a.name.includes("GitHub")||a.name.includes("YouTube")||a.name.includes("Twitter"))&&gsapWithCSS.to(a.rotation,{x:a.userData.initialRotation.x,duration:.3,ease:"back.out(2)"}),(a.name.includes("Boba")||a.name.includes("Name_Letter"))&&gsapWithCSS.to(a.position,{y:a.userData.initialPosition.y,duration:.3,ease:"back.out(2)"}))}window.addEventListener("mousemove",a=>{touchHappened=!1,pointer.x=a.clientX/sizes.width*2-1,pointer.y=-(a.clientY/sizes.height)*2+1});window.addEventListener("touchstart",a=>{isModalOpen||(a.preventDefault(),pointer.x=a.touches[0].clientX/sizes.width*2-1,pointer.y=-(a.touches[0].clientY/sizes.height)*2+1)},{passive:!1});window.addEventListener("touchend",a=>{isModalOpen||(a.preventDefault(),handleRaycasterInteraction())},{passive:!1});window.addEventListener("click",handleRaycasterInteraction);const themeToggleButton=document.querySelector(".theme-toggle-button"),muteToggleButton=document.querySelector(".mute-toggle-button"),sunSvg=document.querySelector(".sun-svg"),moonSvg=document.querySelector(".moon-svg"),soundOffSvg=document.querySelector(".sound-off-svg"),soundOnSvg=document.querySelector(".sound-on-svg"),updateMuteState=a=>{a?backgroundMusic.volume(0):backgroundMusic.volume(BACKGROUND_MUSIC_VOLUME),buttonSounds.click.mute(a),Object.values(pianoSounds).forEach(e=>{e.mute(a)})},handleMuteToggle=a=>{a.preventDefault(),isMuted=!isMuted,updateMuteState(isMuted),buttonSounds.click.play(),gsapWithCSS.to(muteToggleButton,{rotate:-45,scale:5,duration:.5,ease:"back.out(2)",onStart:()=>{isMuted?(soundOnSvg.style.display="none",soundOffSvg.style.display="block"):(soundOffSvg.style.display="none",soundOnSvg.style.display="block"),gsapWithCSS.to(muteToggleButton,{rotate:0,scale:1,duration:.5,ease:"back.out(2)",onComplete:()=>{gsapWithCSS.set(muteToggleButton,{clearProps:"all"})}})}})};let isMuted=!1;muteToggleButton.addEventListener("click",a=>{touchHappened||handleMuteToggle(a)},{passive:!1});muteToggleButton.addEventListener("touchend",a=>{touchHappened=!0,handleMuteToggle(a)},{passive:!1});const toggleFavicons=()=>{const e=document.body.classList.contains("dark-theme")?"light":"dark";document.querySelector('link[sizes="96x96"]').href=`media/${e}-favicon/favicon-96x96.png`,document.querySelector('link[type="image/svg+xml"]').href=`/media/${e}-favicon/favicon.svg`,document.querySelector('link[rel="shortcut icon"]').href=`media/${e}-favicon/favicon.ico`,document.querySelector('link[rel="apple-touch-icon"]').href=`media/${e}-favicon/apple-touch-icon.png`,document.querySelector('link[rel="manifest"]').href=`media/${e}-favicon/site.webmanifest`};let isNightMode=!1;const handleThemeToggle=a=>{a.preventDefault(),toggleFavicons();const e=document.body.classList.contains("dark-theme");document.body.classList.remove(e?"dark-theme":"light-theme"),document.body.classList.add(e?"light-theme":"dark-theme"),isNightMode=!isNightMode,buttonSounds.click.play(),gsapWithCSS.to(themeToggleButton,{rotate:45,scale:5,duration:.5,ease:"back.out(2)",onStart:()=>{isNightMode?(sunSvg.style.display="none",moonSvg.style.display="block"):(moonSvg.style.display="none",sunSvg.style.display="block"),gsapWithCSS.to(themeToggleButton,{rotate:0,scale:1,duration:.5,ease:"back.out(2)",onComplete:()=>{gsapWithCSS.set(themeToggleButton,{clearProps:"all"})}})}}),Object.values(roomMaterials).forEach(t=>{gsapWithCSS.to(t.uniforms.uMixRatio,{value:isNightMode?1:0,duration:1.5,ease:"power2.inOut"})})};themeToggleButton.addEventListener("click",a=>{touchHappened||handleThemeToggle(a)},{passive:!1});themeToggleButton.addEventListener("touchend",a=>{touchHappened=!0,handleThemeToggle(a)},{passive:!1});const clock=new Clock,updateClockHands=()=>{if(!hourHand||!minuteHand)return;const a=new Date,e=a.getHours()%12,t=a.getMinutes(),s=a.getSeconds(),n=(t+s/60)*(Math.PI*2/60),o=(e+t/60)*(Math.PI*2/12);minuteHand.rotation.x=-n,hourHand.rotation.x=-o},render=a=>{const e=clock.getElapsedTime();if(smokeMaterial.uniforms.uTime.value=e,controls.update(),updateClockHands(),xAxisFans.forEach(t=>{t.rotation.x-=.04}),yAxisFans.forEach(t=>{t.rotation.y-=.04}),chairTop){const t=a*.001,n=Math.PI/8*Math.sin(t*.5)*(1-Math.abs(Math.sin(t*.5))*.3);chairTop.rotation.y=chairTop.userData.initialRotation.y+n}if(fish){const t=a*.0015,n=.12*Math.sin(t)*(1-Math.abs(Math.sin(t))*.1);fish.position.y=fish.userData.initialPosition.y+n}if(!isModalOpen){raycaster.setFromCamera(pointer,camera),currentIntersects=raycaster.intersectObjects(raycasterObjects);for(let t=0;t<currentIntersects.length;t++);if(currentIntersects.length>0){const t=currentIntersects[0].object;t.name.includes("Hover")&&t!==currentHoveredObject&&(currentHoveredObject&&playHoverAnimation(currentHoveredObject,!1),playHoverAnimation(t,!0),currentHoveredObject=t),t.name.includes("Pointer")?document.body.style.cursor="pointer":document.body.style.cursor="default"}else currentHoveredObject&&(playHoverAnimation(currentHoveredObject,!1),currentHoveredObject=null),document.body.style.cursor="default"}renderer.render(scene,camera),window.requestAnimationFrame(render)};render();const chatbotData={greetings:["hi","hello","hey","hola","sup","yo"],goodbyes:["bye","goodbye","see you","cya","good night","farewell"],workRelated:["work","brief","portfolio","developed","created","built","made","working on"],responses:{greetings:" Hi! I'm Eshani's bot. Ask me about her education, experience, skills, projects, or social media!",education:` Eshani's Education:
- Currently pursuing Bachelor of Computer Applications (BCA)
- First-year student with focus on computer science
- Special interest in AI/ML and Web Development
- Active participant in coding bootcamps and workshops`,experience:` Eshani's Current Roles:
- Evangelist at Hack4Bengal 4.0
   Promoting Eastern India's largest hackathon
   Community engagement and tech advocacy

- AI Intern at AI Wallah
   Hands-on AI/ML project experience
   Research and development in AI applications

- Technical Member at GeeksforGeeks SNU Chapter
   Contributing to technical content
   Organizing coding workshops`,skills:` Eshani's Technical Arsenal:

Frontend:
- HTML5, CSS3, JavaScript (ES6+)
- React.js ecosystem
- UI/UX design principles

Backend:
- Node.js & Express
- Database management
- API development

Emerging Tech:
- Web3 & Blockchain
- 3D Technologies (Three.js)
- AI/ML fundamentals`,projects:` Featured Projects:

1. 3D Solar System Explorer
    Interactive space visualization
    WebGL and Three.js implementation
    Educational features

2. Rubik's Cube Game
    3D puzzle simulator
    Multiple solving algorithms
    Performance tracking

3. Apple Vision Pro Clone
    Pixel-perfect recreation
    Advanced animations
    Responsive design`,github:` GitHub: @euii-ii
Check out my projects and contributions here:
<a href='https://github.com/euii-ii' target='_blank'>https://github.com/euii-ii</a>`,linkedin:` LinkedIn: Eshani Paul
Let's connect professionally:
<a href='https://www.linkedin.com/in/eshani-paul' target='_blank'>https://www.linkedin.com/in/eshani-paul</a>`,instagram:` Instagram: @eiizz_zz
Follow my tech journey:
<a href='https://www.instagram.com/eiizz_zz' target='_blank'>https://www.instagram.com/eiizz_zz</a>`,contact:` Connect with Eshani:

- GitHub: <a href='https://github.com/euii-ii' target='_blank'>https://github.com/euii-ii</a>
   Check out her code repositories
   View project contributions

- LinkedIn: <a href='https://www.linkedin.com/in/eshani-paul' target='_blank'>https://www.linkedin.com/in/eshani-paul</a>
   Professional network
   Career updates

- Instagram: <a href='https://www.instagram.com/eiizz_zz' target='_blank'>https://www.instagram.com/eiizz_zz</a>
   Tech journey updates
   Behind the scenes content`,github:` GitHub: @euii-ii

Key Repositories:
- 3D Solar System Explorer
- Rubik's Cube Game
- Apple Vision Pro Clone

Visit: https://github.com/euii-ii`,linkedin:` LinkedIn: Eshani Paul

Highlights:
- Frontend Development expertise
- AI/ML enthusiast
- Open to collaborations

Connect: https://www.linkedin.com/public-profile/settings?trk=d_flagship3_profile_self_view_public_profile`,instagram:` Instagram: @eiizz_zz

Content:
- Tech journey documentation
- Project updates
- Coding life

Follow: https://www.instagram.com/eiizz_zz/`,briefEducation:` Quick Education Brief:
BCA student specializing in computer science with focus on AI/ML and web development. Active learner participating in tech bootcamps.`,briefSkills:` Skills Overview:
 Frontend: HTML, CSS, JS, React
 Backend: Node.js, Express
 Emerging: Web3, 3D, AI/ML`,briefProjects:` Project Highlights:
 3D Solar System Explorer - Interactive space visualization
 Rubik's Cube Game - 3D puzzle simulator
 Apple Vision Pro Clone - Responsive web recreation`,fullSummary:` Eshani's Quick Profile:

 Education:
BCA student focused on computer science, AI/ML, and web development

 Key Skills:
 Frontend Development
 Backend Development
 Web3 & 3D Technologies

 Notable Projects:
 3D Solar System Explorer
 Rubik's Cube Game
 Apple Vision Pro Clone

 Connect:
GitHub: <a href='https://github.com/euii-ii' target='_blank'>https://github.com/euii-ii</a>
Instagram: <a href='https://www.instagram.com/eiizz_zz' target='_blank'>https://www.instagram.com/eiizz_zz</a>
LinkedIn: <a href='https://www.linkedin.com/in/eshani-paul' target='_blank'>https://www.linkedin.com/in/eshani-paul</a>`,workBrief:` Work & Projects Overview:

 Currently working on:
 3D Solar System Explorer - Educational space visualization
 Rubik's Cube Game - Interactive puzzle simulator
 Apple Vision Pro Clone - Modern web recreation

 Recent achievements:
 Successfully deployed 3 major web applications
 Implemented complex 3D visualizations
 Created responsive, user-friendly interfaces`,goodbye:" It was great chatting with you! Have a wonderful day! Bye!",default:`I'm not sure about that. Try asking about:
- Education & Skills
- Work Experience
- Projects
- Social Media (GitHub, LinkedIn, Instagram)
- Contact Information`}};class Chatbot{constructor(){this.toggle=document.querySelector(".chatbot-toggle"),this.container=document.querySelector(".chatbot-box"),this.closeBtn=document.querySelector(".close-chat"),this.messagesContainer=document.querySelector(".chatbot-messages"),this.input=document.querySelector(".chatbot-input input"),this.sendBtn=document.querySelector(".send-message"),this.initializeEventListeners()}initializeEventListeners(){this.toggle.addEventListener("click",()=>this.toggleChat()),this.closeBtn.addEventListener("click",()=>this.toggleChat()),this.sendBtn.addEventListener("click",()=>this.handleUserInput()),this.input.addEventListener("keypress",e=>{e.key==="Enter"&&this.handleUserInput()})}toggleChat(){this.container.classList.toggle("hidden"),this.container.classList.contains("hidden")||(this.input.focus(),this.messagesContainer.children.length===0&&this.addMessage(chatbotData.responses.greetings,"bot"))}handleUserInput(){const e=this.input.value.trim();e&&(this.addMessage(e,"user"),this.input.value="",this.generateResponse(e))}addMessage(e,t){const s=document.createElement("div");s.classList.add("message",t),s.innerHTML=e,this.messagesContainer.appendChild(s),this.messagesContainer.scrollTop=this.messagesContainer.scrollHeight}generateResponse(e){const t=e.toLowerCase();let s;if(chatbotData.goodbyes.some(i=>t.includes(i))){s=chatbotData.responses.goodbye,setTimeout(()=>{this.addMessage(s,"bot"),setTimeout(()=>this.toggleChat(),2e3)},500);return}const n=chatbotData.workRelated.some(i=>t.includes(i)),o=t.includes("work")||t.includes("built")||t.includes("portfolio");n&&(t.includes("brief")||t.includes("tell")||t.includes("about"))?s=chatbotData.responses.workBrief:o?s=chatbotData.responses.projects:t.includes("brief")||t.includes("summary")||t.includes("overview")?t.includes("education")||t.includes("study")?s=chatbotData.responses.briefEducation:t.includes("skill")||t.includes("tech")?s=chatbotData.responses.briefSkills:t.includes("project")||t.includes("work")?s=chatbotData.responses.briefProjects:s=chatbotData.responses.fullSummary:t.includes("tell")&&t.includes("about")?s=chatbotData.responses.fullSummary:chatbotData.greetings.some(i=>t.includes(i))?s=chatbotData.responses.greetings:t.includes("education")?s=chatbotData.responses.education:t.includes("experience")?s=chatbotData.responses.experience:t.includes("skill")?s=chatbotData.responses.skills:t.includes("project")?s=chatbotData.responses.projects:t.includes("github")?s=chatbotData.responses.github:t.includes("linkedin")?s=chatbotData.responses.linkedin:t.includes("instagram")?s=chatbotData.responses.instagram:t.includes("contact")?s=chatbotData.responses.contact:s=chatbotData.responses.default,setTimeout(()=>{this.addMessage(s,"bot")},500)}}document.addEventListener("DOMContentLoaded",()=>{new Chatbot});
